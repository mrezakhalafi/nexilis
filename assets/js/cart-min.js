if(null!=localStorage.getItem("cart"))var cart=JSON.parse(localStorage.getItem("cart"));else cart=[];function getFpin(){let e;try{e=window.Android.getFPin()}catch(t){e=new URLSearchParams(window.location.search).get("f_pin")}return e}function clearCart(){let e=0,t=0;cart.forEach((a=>{e+=a.items.length,t+=a.items.filter((e=>"checked"==e.selected)).length})),e==t?localStorage.removeItem("cart"):(cart.forEach((e=>{e.items=e.items.filter((e=>"checked"!=e.selected))})),localStorage.setItem("cart",JSON.stringify(cart)))}function numberWithDots(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function countTotal(e,t){let a=0;return"all"==e?cart.forEach((e=>{e.items.forEach((e=>{"checked"==e.selected&&(a+=e.itemQuantity*e.itemPrice)}))})):cart.forEach((i=>{i.merchant_name==e&&i.items.forEach((e=>{("cart"==t&&"checked"==e.selected||"saved"==t&&"checked"!=e.selected)&&(a+=e.itemQuantity*e.itemPrice)}))})),"Rp "+numberWithDots(a)}function changeValue(e,t,a,i,o){"add"==t?document.getElementById(e).value<o&&(document.getElementById(e).value=parseInt(document.getElementById(e).value)+1):document.getElementById(e).value>1&&(document.getElementById(e).value=parseInt(document.getElementById(e).value)-1),cart.forEach((t=>{if(t.items.forEach((t=>{t.itemName==e.split("-")[0]&&(t.itemQuantity=parseInt(document.getElementById(e).value),localStorage.setItem("cart",JSON.stringify(cart)),countTotal(a,i),"cart"==i?populateCart():populateSaved())})),t.merchant_name==a){document.getElementById("total-"+a.split(/\s+/).join("-")+i=="cart"?"cart":"saved").innerText=countTotal(a,i)}}))}function checkItem(e,t){cart.forEach((t=>{t.items.find((t=>{t.itemName==e&&null==t.selected?(t.selected="checked",document.getElementById("checkout-button").classList.remove("d-none"),localStorage.setItem("cart",JSON.stringify(cart))):t.itemName==e&&null!=t.selected&&(t.selected=void 0,localStorage.setItem("cart",JSON.stringify(cart)),"Rp 0"==countTotal("all")&&document.getElementById("checkout-button").classList.add("d-none"))}))})),populateCart(),populateSaved(),changeTab(t)}function populateSaved(){let e=JSON.parse(localStorage.getItem("cart"));e.forEach((e=>e.items=e.items.filter((e=>null==e.selected)))),e=e.filter((e=>e.items.length>0)),document.getElementById("cart-items").classList.add("d-none"),document.getElementById("pricetag").classList.add("d-none"),document.getElementById("checkout-button").classList.add("d-none"),document.getElementById("cart-saved").classList.remove("d-none");let t=document.getElementById("cart-saved");t.innerHTML="",e.length>0?(document.getElementById("cart-empty").classList.add("d-none"),document.getElementById("cart-body").classList.remove("d-none"),e.slice().reverse().forEach((e=>{let a=e.merchant_name,i="";i=0==localStorage.lang?"View Profile":"Kunjungi Profil",1==e.official_acc||3==e.official_acc?icon_verified='<img class="verified" src="../assets/img/ic_official_flag.webp">':2==e.official_acc&&(icon_verified='<img class="verified" src="../assets/img/ic_verified_flag.png">');let o=`<div class="container-fluid p-4 shop">\x3c!-- shop name --\x3e<div class="row"><div class="col-6"><div class="row font-semibold store-name"><div class="col-2">${icon_verified}</div><div class="col-10 px-1">${a}</div></div></div><div class="col-6 align-items-center text-end small-text"><a href="tab3-profile?store_id=${e.items[0].store_id}&f_pin=${getFpin()}" target = "_self"><img class="view-store" src="../assets/img/cart/store_purple.png"> `+i+"</a></div></div>\x3c!-- item 1 --\x3e"+`<div class="row mt-3" id="${a}-items-saved"></div></div><div class="container-fluid px-4 py-2"><div class="row"><div class="col-6 font-semibold">Total</div>`+`<div id="total-${a.split(/\s+/).join("-")}-saved" class="col-6 font-semibold text-end">`+`${countTotal(a,"saved")}</div></div></div><hr class="shop-border">`;t.innerHTML+=o;let n=document.getElementById(`${a}-items-saved`);e.items.forEach((e=>{let t,i=e.thumbnail;var o;i.includes("http://202.158.33.26")&&(i=i.replace("http://202.158.33.26","")),i.includes("/nexilis/images/")||(i="/nexilis/images/"+i),t="mp4"!=(o=(o=e.thumbnail).substr(1+o.lastIndexOf("/")).split("?")[0]).split("#")[0].substr(o.lastIndexOf(".")+1)?`<img class="product-img" src="${i}">`:`<video class="product-img" autoplay muted>\n                        <source src="${i}" type="video/mp4" />\n                    </video>`;let s="";s=0==localStorage.lang?"Move to cart":"Pindah ke keranjang";let l=`<div class="row mt-3">\x3c!-- img --\x3e<div class="col-3">${t}</div>\x3c!-- details --\x3e<div class="col-8 col-details font-medium"><div class="ps-3"><span class="item-name">${e.itemName}</span><div class="item-price">Rp ${numberWithDots(e.itemPrice)}</div><div class="row"><div class="col-5"><div class="input-group counter mt-2" style="width: 75px;"><button class="btn btn-outline-secondary btn-decrease" type="button" onclick="changeValue('${e.itemName}-quantity', 'sub', '${a}', 'saved', ${e.maxQty});">-</button><input id="${e.itemName}-quantity" disabled type="number" maxlength="3" class="form-control text-center" min="1" value="${e.itemQuantity}"><button class="btn btn-outline-secondary btn-increase" type="button" onclick="changeValue('${e.itemName}-quantity', 'add', '${a}', 'saved', ${e.maxQty});">+</button></div></div><div class="col-6 d-flex align-items-end justify-content-center"><div class="text-grey" onclick="checkItem('${e.itemName}', 'items')">`+s+'</div></div></div></div></div>\x3c!-- delete item --\x3e<div class="col-1 col-delete"><div class="delete-btn">'+`<img onclick="deleteItem('${a}', '${e.itemName}', 'saved');" class="delete-icon" src="../assets/img/cart/Delete.png"></div></div></div>`;n.innerHTML+=l}))}))):document.getElementById("cart-empty").classList.remove("d-none")}function populateCart(e){let t=localStorage.getItem("cart");t||(t="[]");let a=JSON.parse(t);a.forEach((e=>e.items=e.items.filter((e=>"checked"==e.selected)))),a=a.filter((e=>e.items.length>0)),document.getElementById("cart-items").classList.remove("d-none"),document.getElementById("cart-saved").classList.add("d-none"),document.getElementById("cart-items").innerHTML="",a.length>0?(document.getElementById("cart-empty").classList.add("d-none"),document.getElementById("cart-body").classList.remove("d-none"),document.getElementById("checkout-button").classList.remove("d-none"),a.slice().reverse().forEach((e=>{let t=e.merchant_name,a=document.getElementById("cart-items"),i="";i=0==localStorage.lang?"View Profile":"Kunjungi Profil";let o="";1==e.official_acc||3==e.official_acc?o='<img class="verified" src="../assets/img/ic_official_flag.webp">':2==e.official_acc&&(o='<img class="verified" src="../assets/img/ic_verified_flag.png">');let n=`<div class="container-fluid p-4 shop">\x3c!-- shop name --\x3e<div class="row"><div class="col-6"><div class="row font-semibold store-name"><div class="col-2">${o}</div><div class="col-10 px-1">${t}</div></div></div><div class="col-6 align-items-center text-end small-text"><a href="tab3-profile?store_id=${e.items[0].store_id}&f_pin=${getFpin()}" target = "_self"><img class="view-store" src="../assets/img/cart/store_purple.png"> `+i+"</a></div></div>\x3c!-- item 1 --\x3e"+`<div class="row mt-3" id="${t}-items-cart"></div></div><div class="container-fluid px-4 py-2"><div class="row"><div class="col-6 font-semibold">Total</div>`+`<div id="total-${t.split(/\s+/).join("-")}-cart" class="col-6 font-semibold text-end">`+`${countTotal(t,"cart")}</div></div></div><hr class="shop-border">`;a.innerHTML+=n;let s=document.getElementById(`${t}-items-cart`);e.items.forEach((e=>{let a,i=e.thumbnail;var o;i.includes("http://202.158.33.26")&&(i=i.replace("http://202.158.33.26","")),i.includes("/nexilis/images/")||(i="/nexilis/images/"+i),a="mp4"!=(o=(o=e.thumbnail).substr(1+o.lastIndexOf("/")).split("?")[0]).split("#")[0].substr(o.lastIndexOf(".")+1)?`<img class="product-img" src="${i}">`:`<video class="product-img" autoplay muted>\n                        <source src="${i}" type="video/mp4" />\n                    </video>`;let n="";n=0==localStorage.lang?"Save for later":"Simpan barang";let l=`<div class="row mt-3">\x3c!-- img --\x3e<div class="col-3">${a}</div>\x3c!-- details --\x3e<div class="col-8 col-details font-medium"><div class="ps-3"><span class="item-name">${e.itemName}</span><div class="item-price">Rp ${numberWithDots(e.itemPrice)}</div><div class="row"><div class="col-5"><div class="input-group counter mt-2" style="width: 75px;"><button class="btn btn-outline-secondary btn-decrease" type="button" onclick="changeValue('${e.itemName}-quantity', 'sub', '${t}', 'cart', ${e.maxQty});">-</button><input id="${e.itemName}-quantity" disabled type="number" maxlength="3" class="form-control text-center" min="1" value="${e.itemQuantity}"><button class="btn btn-outline-secondary btn-increase" type="button" onclick="changeValue('${e.itemName}-quantity', 'add', '${t}', 'cart', ${e.maxQty});">+</button></div></div><div class="col-6 d-flex align-items-end justify-content-center"><div class="text-grey" onclick="checkItem('${e.itemName}', 'saved')">`+n+'</div></div></div></div></div>\x3c!-- delete item --\x3e<div class="col-1 col-delete"><div class="delete-btn">'+`<img onclick="deleteItem('${t}', '${e.itemName}', 'cart');" class="delete-icon" src="../assets/img/cart/Delete.png"></div></div></div>`;s.innerHTML+=l,payment()}))}))):(document.getElementById("checkout-button").classList.add("d-none"),document.getElementById("cart-empty").classList.remove("d-none"),document.getElementById("pricetag").classList.add("d-none"))}async function payment(){let e=JSON.parse(localStorage.getItem("cart"));if(e.forEach((e=>e.items=e.items.filter((e=>"checked"==e.selected)))),e=e.filter((e=>e.items.length>0)),0==e.length){document.getElementById("cart-body").classList.add("d-none"),document.getElementById("checkout-button").classList.add("d-none"),document.getElementById("cart-empty").classList.remove("d-none")}else{let t={data:{fixed_price:1e4,time_detail:[{service:"same_day",time_delivery_end:"27-Oct-2022"}]}},a=0,i=t.data.fixed_price,o=0,n=0;t.data.time_detail.forEach((e=>{let t=`<div class="row mb-2" style="border: 1px solid lightgray"><div class="col-1 d-flex align-items-center justify-content-center p-0 delivery-options" style="margin-right: 5px;" onclick="checkThis(this);"><span style="height: 15px;width: 15px;background-color: transparent;border: 1px solid lightgray;border-radius: 50%;display: inline-block;"></span></div><div class="col-9"><div class="row fw-bold">${e.service} ${i}</div><div class="row gray-text">Delivered on or before ${e.time_delivery_end} ${"same_day"==e.service?"today":"next day"}</div></div></div>`;null==document.getElementById("delivery-options")||(document.getElementById("delivery-options").innerHTML+=t)})),e.forEach((e=>{e.items.forEach((e=>{null!=e.selected&&(o+=e.itemQuantity*e.itemPrice,n+=parseInt(e.itemQuantity))}))}));let s=o+a/100*o+i;localStorage.setItem("grand-total",s),document.getElementById("total-item").innerHTML=`Sub-total ( ${n} items )`,document.getElementById("total-price").innerHTML=`Rp ${numberWithDots(o)}`,document.getElementById("delivery-cost").innerHTML=`Rp ${numberWithDots(i)}`,document.getElementById("total-price-tax-inc").innerHTML=`Rp ${numberWithDots(s)}`}}async function deleteItem(e,t,a){let i=new ConfirmModal(e,t);if(1==await i.question()){let i=cart.find((t=>t.merchant_name==e)).items,o=i.indexOf(i.find((e=>e.itemName==t))),n=cart.indexOf(cart.find((t=>t.merchant_name==e)));cart.find((t=>t.merchant_name==e)).items.splice(o,1),0==cart.find((t=>t.merchant_name==e)).items.length&&cart.splice(n,1),localStorage.setItem("cart",JSON.stringify(cart)),cart=JSON.parse(localStorage.getItem("cart")),countTotal(e,a)}"cart"==a?populateCart():populateSaved()}function goBack(){window.history.back()}function selectMethod(e){document.getElementById("dropdownMenuSelectMethod").innerHTML=`${e.innerHTML} >`,payment_method=e.innerHTML}function getMerchantAddress(e){return JSON.parse('{"ID":1,"STORE_CODE":"1","ADDRESS":"Jl. Sultan Iskandar Muda No.6C","VILLAGE":"Kebayoran Lama","DISTRICT":"Kebayoran Lama","CITY":"Jakarta Selatan","PROVINCE":"DKI Jakarta","ZIP_CODE":"12240","PHONE_NUMBER":"081987654321","NOTE":"Lantai 6 divisi IT"}')}function getItemDetail(e){return JSON.parse('{"ID":1,"PRODUCT_CODE":"1","LENGTH":12,"WIDTH":13,"HEIGHT":14,"IS_FRAGILE":0,"WEIGHT":1,"CATEGORY":"Snack"}')}function selectedItems(){let e=[];return cart.forEach((t=>{let a={};t.items.forEach((e=>{a.merchant_name=t.merchant_name,null==a.items&&(a.items=[]),a.items.push(e)})),0!==Object.entries(a).length&&e.push(a)})),e}function shippingRate(){let e=new FormData,t=selectedItems().length;for(let a=0;a<t;a++){let t=getMerchantAddress(selectedItems("checked")[a].merchant_name),i=selectedItems("checked")[0].items;for(let a of i){let i=getItemDetail(a.itemName);return e.append("address_origin",t.ADDRESS),e.append("province_origin",t.PROVINCE),e.append("city_origin",t.CITY),e.append("district_origin",t.DISTRICT),e.append("zip_code_origin",t.ZIP_CODE),e.append("address_destination","jl sultan iskandar muda no 6c"),e.append("province_destination","dki jakarta"),e.append("city_destination","jakarta selatan"),e.append("district_destination","kebayoran lama"),e.append("zip_code_destination","12240"),e.append("weight_items",i.WEIGHT),e.append("length_items",i.LENGTH),e.append("width_items",i.WIDTH),e.append("height_items",i.HEIGHT),new Promise((function(t,a){var i=new XMLHttpRequest;i.open("POST","/nexilis/logics/shipment_api/paxel_shipments_rate"),i.onload=function(){this.status>=200&&this.status<300?t(JSON.parse(i.response)):a({status:this.status,statusText:i.statusText})},i.onerror=function(){a({status:this.status,statusText:i.statusText})},i.send(e)}))}}}function checkThis(e){document.querySelectorAll(".delivery-options").forEach((e=>{e.innerHTML='<span style="height: 15px;width: 15px;background-color: transparent;border: 1px solid lightgray;border-radius: 50%;display: inline-block;"></span>'})),e.innerHTML='<img src="../assets/img/tab5/verified-black.png" alt="verified-icon" class="small-icon">'}window.addEventListener("storage",(async function(){cart=null!=localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")):[],document.getElementById("cart-items").innerHTML="",await populateCart(),"Rp 0"==countTotal("all")&&document.getElementById("checkout-button").classList.add("d-none")}),!1);var cardModalHtml='<div id="three-ds-container" style="display: none;">   <iframe id="sample-inline-frame" name="sample-inline-frame" width="100%" height="400"> </iframe></div><form id="credit-card-form" name="creditCardForm" method="post"><fieldset id="fieldset-card"><div class="col p-3">  <div class="row">    Credit Card Number  </div>  <div class="row mb-2">    <input maxlength="16" size="16" type="text" required class="form-control" id="credit-card-number" placeholder="e.g: 4000000000001091" name="creditCardNumber">  </div>  <div class="row mb-4">    <div class="col-3">  <div class="row">    Month  </div>      <div class="row">        <select required class="form-control form-control fs-16 fontRobReg" id="credit-card-exp-month" placeholder="MM" style="border-color: #608CA5" name="creditCardExpMonth">          <option>01</option>          <option>02</option>          <option>03</option>          <option>04</option>          <option>05</option>          <option>06</option>          <option>07</option>          <option>08</option>          <option>09</option>          <option>10</option>          <option>11</option>          <option>12</option>        </select>      </div>    </div>    <div class="col-5 mx-1">  <div class="row">    Year  </div>      <div class="row">        <input maxlength="4" size="4" type="text" required class="form-control form-control fs-16 fontRobReg" id="credit-card-exp-year" placeholder="YYYY" style="border-color: #608CA5" name="creditCardExpYear">      </div>    </div>    <div class="col-3">  <div class="row">    CVV  </div>      <div class="row">        <input maxlength="3" size="3" type="text" required class="form-control form-control fs-16 fontRobReg" id="credit-card-cvv" placeholder="123" style="border-color: #608CA5" name="creditCardCvv">      </div>    </div>  </div><div class="row">  <input class="pay-button" onclick="return toSubmit();" type="submit" id="pay-with-credit-card" value="Pay" name="payWithCreditCard"></div></div></fieldset></form>',ovoModalHtml='<form id="ovo-form" name="ovoForm" method="post"><fieldset id="fieldset-ovo"><div class="col p-3">  <div class="row">Phone Number</div>  <div class="row mb-2">    <input maxlength="16" size="16" type="text" required id="phone-number" placeholder="e.g: +6282111234567" name="phoneNumber">  </div>  <div class="row">       <input class="pay-button" onclick="return toSubmitOVO();" type="submit" id="pay-with-ovo" value="Pay" name="payWithOVO">  </div></div></fieldset></form>',danaModalHtml='<form id="dana-form" name="danaForm" method="post"><fieldset id="fieldset-dana">   <div class="col p-3">       <div class="row">           <input class="pay-button" onclick="return toSubmitDANA();" type="submit" id="pay-with-dana" class="col-md-12 simple-modal-button-green py-1 px-3 m-0 my-4 fs-16" value="Pay" name="payWithDANA">       </div>   </div></fieldset></form>',linkajaModalHtml='<form id="linkaja-form" name="linkajaForm" method="post"><fieldset id="fieldset-linkaja">   <div class="col p-3">       <div class="row">           <input class="pay-button" onclick="return toSubmitLINKAJA();" type="submit" id="pay-with-linkaja" class="col-md-12 simple-modal-button-green py-1 px-3 m-0 my-4 fs-16" value="Pay" name="payWithLINKAJA">       </div>   </div></fieldset></form>',shopeepayModalHtml='<form id="shopeepay-form" name="shopeepayForm" method="post"><fieldset id="fieldset-shopeepay">   <div class="col p-3">       <div class="row">           <input class="pay-button" onclick="return toSubmitSHOPEE();" type="submit" id="pay-with-shopeepay" class="col-md-12 simple-modal-button-green py-1 px-3 m-0 my-4 fs-16" value="Pay" name="payWithSHOPEEPAY">       </div>   </div></fieldset></form>',qrisModalHtml='<form id="qris-form" name="qrisForm" method="post"><fieldset id="fieldset-qris">   <div class="col p-3">       <div class="row">           <div id="qrcode"></div>           <input class="pay-button" onclick="return toSubmitQRIS();" type="submit" id="pay-with-qris" class="col-md-12 simple-modal-button-green py-1 px-3 m-0 my-4 fs-16" value="Generate QR Code" name="payWithQRIS">           <br><button type="button" class="pay-button mt-3 d-none" id="simulate-qris-payment">Pay QRIS</button>       </div>   </div></fieldset></form>';function toSubmitOVO(){event.preventDefault();var e={phone_number:$("#phone-number").val(),amount:localStorage.getItem("grand-total")};$.post("../logics/paliobutton/php/paliopay_ovo",e,(function(e,t){try{if("SUCCEEDED"==e){clearCart();var a=JSON.stringify(cart),i=btoa(a),o=getFpin();let e=[];cart.forEach((t=>{t.items.forEach((t=>{if("checked"==t.selected){let a={};a.p_code=t.itemCode,a.price=t.itemPrice,a.amount=t.itemQuantity,a.isPost=t.isPost,a.maxQty=t.maxQty,e.push(a)}}))})),postForm("../logics/paliobutton/php/store_payment",{fpin:o,method:"OVO",status:"success",items:i,cart:btoa(JSON.stringify(e))})}else alert("Credit card transaction failed")}catch(e){alert("Error occured")}}))}function toSubmitDANA(){event.preventDefault();let e=new URLSearchParams(window.location.search).get("f_pin");var t={callback:window.location.origin+"/nexilis/pages/checkout.php?f_pin="+e,amount:localStorage.getItem("grand-total")};$.post("../logics/paliobutton/php/paliopay_dana",t,(function(e,t){try{var a=JSON.parse(e);localStorage.setItem("ewallet_id",a.id),checkEwallet(a.id),window.location.href=a.actions.desktop_web_checkout_url}catch(e){alert("Error occured")}}))}function toSubmitSHOPEE(){event.preventDefault();let e=new URLSearchParams(window.location.search).get("f_pin");var t={callback:window.location.origin+"/nexilis/pages/checkout.php?f_pin="+e,amount:localStorage.getItem("grand-total")};$.post("../logics/paliobutton/php/paliopay_shopee",t,(function(e,t){try{var a=JSON.parse(e);localStorage.setItem("ewallet_id",a.id),checkEwallet(a.id),window.location.href=a.actions.mobile_deeplink_checkout_url}catch(e){alert("Error occured")}}))}function checkQRISStatus(e){let t=new XMLHttpRequest;t.open("GET","../logics/qris_check?id="+e),t.responseType="json",t.send(),t.onload=async function(){if(200!=t.status)alert(`Error ${t.status}: ${t.statusText}`);else{let s=t.response;if("COMPLETED"==s.status){var a=s.payment_detail.source;clearCart();var i=JSON.stringify(cart),o=btoa(i),n=getFpin();let e=[];cart.forEach((t=>{t.items.forEach((t=>{if("checked"==t.selected){let a={};a.p_code=t.itemCode,a.price=t.itemPrice,a.amount=t.itemQuantity,a.isPost=t.isPost,a.maxQty=t.maxQty,e.push(a)}}))})),postForm("../logics/paliobutton/php/store_payment",{fpin:n,method:a,status:"success",items:o,cart:btoa(JSON.stringify(e))})}else checkQRISStatus(e)}},t.onerror=function(){alert("Request failed")}}function simulateQRISPayment(e){var t={amount:localStorage.getItem("grand-total"),external_id:e};$.post("../logics/paliobutton/php/qris_check",t,(function(e,t){try{let t=JSON.parse(e);if("COMPLETED"==t.status){var a=t.payment_details.source?t.payment_details.source:"TEST_QRIS";clearCart();var i=JSON.stringify(cart),o=btoa(i),n=getFpin();let e=[];cart.forEach((t=>{t.items.forEach((t=>{if("checked"==t.selected){let a={};a.p_code=t.itemCode,a.price=t.itemPrice,a.amount=t.itemQuantity,a.isPost=t.isPost,a.maxQty=t.maxQty,e.push(a)}}))})),postForm("../logics/paliobutton/php/store_payment",{fpin:n,method:a,status:"success",items:o,cart:btoa(JSON.stringify(e))})}else checkQRISStatus(id)}catch(e){alert("Error occured")}}))}function runSimulateQRIS(e){$("#simulate-qris-payment").off("click"),$("#simulate-qris-payment").removeClass("d-none"),$("#simulate-qris-payment").click((function(t){t.preventDefault(),simulateQRISPayment(e)}))}function toSubmitQRIS(){event.preventDefault();let e=new URLSearchParams(window.location.search).get("f_pin");var t={callback:window.location.origin+"/nexilis/pages/payment.php?f_pin="+e,amount:localStorage.getItem("grand-total")};$("#pay-with-qris").prop("disabled",!0),$("div#qrcode").html(""),$.post("../logics/paliobutton/php/paliopay_qris",t,(function(e,t){try{var a=JSON.parse(e);new QRCode(document.getElementById("qrcode"),a.qr_string),runSimulateQRIS(a.external_id)}catch(e){alert("Error occured"),$("#pay-with-qris").prop("disabled",!1)}}))}function toSubmitLINKAJA(){event.preventDefault();var e={callback:window.location.origin+"/nexilis/pages/checkout.php?f_pin="+getFpin(),amount:localStorage.getItem("grand-total")};$.post("../logics/paliobutton/php/paliopay_linkaja",e,(function(e,t){try{var a=JSON.parse(e);localStorage.setItem("ewallet_id",a.id),checkEwallet(a.id),window.location.href=a.actions.desktop_web_checkout_url}catch(e){alert("Error occured")}}))}function checkEwallet(e){let t=new XMLHttpRequest;t.open("GET","../logics/ewallet_check?id="+e),t.responseType="json",t.send(),t.onload=async function(){if(200!=t.status)alert(`Error ${t.status}: ${t.statusText}`);else{let s=t.response;if("SUCCEEDED"==s.status||"COMPLETED"==s.status){if(localStorage.removeItem("ewallet_id"),"ID_DANA"==s.channel_code)var a="DANA";else if("ID_LINKAJA"==s.channel_code)a="LINKAJA";else if("ID_SHOPEEPAY"==s.channel_code)a="SHOPEEPAY";clearCart();var i=JSON.stringify(cart),o=btoa(i),n=getFpin();let e=[];cart.forEach((t=>{t.items.forEach((t=>{if("checked"==t.selected){let a={};a.p_code=t.itemCode,a.price=t.itemPrice,a.amount=t.itemQuantity,a.isPost=t.isPost,a.maxQty=t.maxQty,e.push(a)}}))})),postForm("../logics/paliobutton/php/store_payment",{fpin:n,method:a,status:"success",items:o,cart:btoa(JSON.stringify(e))})}else checkEwallet(e)}},t.onerror=function(){alert("Request failed")}}function toSubmit(){event.preventDefault(),document.getElementById("fieldset-card").setAttribute("disabled","disabled"),Xendit.setPublishableKey("xnd_public_development_qcfW9OvrvG3U0ph6Dc01xNMhKhhW2On4a0l7ZMUS696BBWR8vNbkSKyRZGlOLQ");var e=getTokenData();Xendit.card.createToken(e,xenditResponseHandler)}function postForm(e,t,a){a=a||"post";var i=document.createElement("form");for(var o in i.setAttribute("method",a),i.setAttribute("action",e),t)if(t.hasOwnProperty(o)){var n=document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name",o),n.setAttribute("value",t[o]),i.appendChild(n)}document.body.appendChild(i),i.submit()}function xenditResponseHandler(e,t){if(e)return displayError(e);"APPROVED"===t.status||"VERIFIED"===t.status?displaySuccess(t):"IN_REVIEW"===t.status?(window.open(t.payer_authentication_url,"sample-inline-frame"),$(".overlay").show(),$("#three-ds-container").show()):("FRAUD"===t.status||"FAILED"===t.status)&&displayError(t)}function displayError(e){alert("Request Credit Card Charge Failed"),$("#three-ds-container").hide(),$(".overlay").hide(),document.getElementById("fieldset-card").removeAttribute("disabled")}function displaySuccess(e){var t=$("#credit-card-form");$("#three-ds-container").hide(),$(".overlay").hide();var a={token_id:e.id,amount:localStorage.getItem("grand-total"),cvv:t.find("#credit-card-cvv").val()},i=JSON.stringify(cart),o=btoa(i),n=getFpin();let s=[];cart.forEach((e=>{e.items.forEach((e=>{if("checked"==e.selected){let t={};t.p_code=e.itemCode,t.price=e.itemPrice,t.amount=e.itemQuantity,t.isPost=e.isPost,t.maxQty=e.maxQty,s.push(t)}}))})),$.post("../logics/paliobutton/php/paliopay",a,(function(e,t){try{if("CAPTURED"==e.status)clearCart(),postForm("../logics/paliobutton/php/store_payment",{fpin:n,method:"card",status:"success",items:o,cart:btoa(JSON.stringify(s))});else{alert("Credit card transaction failed"),document.getElementById("fieldset-card").removeAttribute("disabled")}}catch(e){alert("Error occured"),document.getElementById("fieldset-card").removeAttribute("disabled")}}),"json")}function getTokenData(){var e=$("#credit-card-form");return{amount:localStorage.getItem("grand-total"),card_number:e.find("#credit-card-number").val(),card_exp_month:e.find("#credit-card-exp-month").val(),card_exp_year:e.find("#credit-card-exp-year").val(),card_cvn:e.find("#credit-card-cvv").val(),is_multiple_use:!1,should_authenticate:!0}}function checkStock(){let e=cart.map((e=>e.items)),t=[].concat(...e),a=t.map((({itemCode:e})=>e)),i=new FormData;i.append("items",btoa(JSON.stringify(a)));let o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){let e=JSON.parse(o.responseText),a=!0,i="";t.forEach((t=>{let o=e.find((e=>e.CODE==t.itemCode));t.itemQuantity>o.QUANTITY&&(i=o.NAME,a=!1,$("#modal-warning-stock .modal-body").html("The item '"+i+"' is no longer in stock. If you wish to proceed with the purchase, please remove it from your cart."))})),a?palioPay():$("#modal-warning-stock").modal("toggle")}},o.open("post","../logics/check_stock"),o.send(i)}async function palioPay(){this.myModal=new SimpleModal;try{await myModal.question()}catch(e){}}var payment_method="";class SimpleModal{constructor(e){this.modalTitle="title",this.parent=document.body,this.modal=document.getElementById("modal-payment-body"),this.modal.innerHTML="",this._createModal()}question(){return new Promise(((e,t)=>{this.closeButton.addEventListener("click",(()=>{e(null),this._destroyModal()}))}))}_createModal(){const e=document.createElement("div");e.classList.add("container"),this.modal.appendChild(e);const t=document.createElement("span");t.setAttribute("id","payment-form"),payment_method.includes("CARD")?t.innerHTML=cardModalHtml:payment_method.includes("OVO")?t.innerHTML=ovoModalHtml:payment_method.includes("DANA")?t.innerHTML=danaModalHtml:payment_method.includes("LINKAJA")?t.innerHTML=linkajaModalHtml:payment_method.includes("SHOPEEPAY")?t.innerHTML=shopeepayModalHtml:payment_method.includes("QRIS")?t.innerHTML=qrisModalHtml:t.innerHTML=cardModalHtml,e.appendChild(t),$("#modal-payment").modal("show")}_destroyModal(){this.parent.removeChild(this.modal)}}class ConfirmModal{constructor(e,t){0==localStorage.lang?this.html='<form method="post"><fieldset>   <div class="col p-3">       <div class="row">           Delete this item from your cart?       </div>       <div class="row">           <button id="confirm-delete" class="col-md-12 py-1 px-3 m-0 my-1 fs-16">Delete</button>       </div>   </div></fieldset></form>':1==localStorage.lang&&(this.html='<form method="post"><fieldset>   <div class="col p-3">       <div class="row">           Hapus barang ini dari keranjang?       </div>       <div class="row">           <button id="confirm-delete" class="col-md-12 py-1 px-3 m-0 my-1 fs-16">Hapus</button>       </div>   </div></fieldset></form>'),this.parent=document.body,this.modal=document.getElementById("modal-payment-body"),this.modal.innerHTML=" ",this._createModal()}question(){return this.delete_button=document.getElementById("confirm-delete"),new Promise(((e,t)=>{this.delete_button.addEventListener("click",(()=>{event.preventDefault(),e(!0),this._destroyModal()}))}))}_createModal(){const e=document.createElement("div");e.classList.add("container"),this.modal.appendChild(e);const t=document.createElement("span");t.setAttribute("id","payment-form"),t.innerHTML=this.html,e.appendChild(t),$("#modal-payment").modal("show")}_destroyModal(){$("#modal-payment").modal("hide")}}class PromoModal{constructor(){let e="Insert Promo Code",t="Apply";1==localStorage.lang&&(e="Masukkan kode promo",t="Aplikasikan"),this.html='<form method="post"><fieldset>   <div class="col p-3">       <div class="row font-semibold">'+e+'       </div>       <div class="row d-flex align-items-center justify-content-end">           <input type="text" id="input-promo" class="position-relative py-3 px-3 m-0 my-1 fs-16" style="border: 1px solid lightgrey;">           <span id="confirm-promo" class="position-absolute font-semibold  py-1 px-3 m-0 my-1 fs-16" style="width: auto; background-color: transparent; color: black;">'+t+"</span>       </div>   </div></fieldset></form>",this.parent=document.body,this.modal=document.getElementById("modal-payment-body"),this.modal.innerHTML=" ",this._createModal()}question(){return this.delete_button=document.getElementById("confirm-promo"),new Promise(((e,t)=>{this.delete_button.addEventListener("click",(()=>{event.preventDefault(),e(document.getElementById("input-promo").value),this._destroyModal()}))}))}_createModal(){const e=document.createElement("div");e.classList.add("container"),this.modal.appendChild(e);const t=document.createElement("span");t.setAttribute("id","payment-form"),t.innerHTML=this.html,e.appendChild(t),$("#modal-payment").modal("show")}_destroyModal(){$("#modal-payment").modal("hide")}}async function enterPromoCode(){let e=new PromoModal,t=await e.question(),a=1==localStorage.lang?"Masukkan kode promo >":"Enter promo code >";""!==t.trim()?document.getElementById("promo-code").innerHTML=`<b>${t}</b>`:document.getElementById("promo-code").innerHTML=`${a}`}function pullRefresh(){window.Android&&0==$("#your-cart").scrollTop()&&window.scrollTo(0,document.body.scrollHeight-(document.body.scrollHeight-3))}function deliveryAddress(e=""){let t=new FormData;return t.append("fpin",getFpin()),t.append("address",e),new Promise((function(e,a){var i=new XMLHttpRequest;i.open("POST","/nexilis/logics/get_delivery_address"),i.onload=function(){this.status>=200&&this.status<300?e(i.response):a({status:this.status,statusText:i.statusText})},i.onerror=function(){a({status:this.status,statusText:i.statusText})},i.send(t)}))}$((function(){$("#your-cart").scroll((function(){})),null!==localStorage.getItem("ewallet_id")&&checkEwallet(localStorage.getItem("ewallet_id")),pullRefresh()}));class AddressModal{constructor(e){this.delivery_address=e,this.html=`<form method="post"><fieldset>   <div class="col p-3">       <div class="row">           Insert delivery address       </div>       <div class="row">           <input type="text" id="input-address" class="col-md-12 simple-modal-button-green py-1 px-3 m-0 my-1 fs-16" value='${this.delivery_address}'>           <button id="confirm-address" class="col-md-12 simple-modal-button-green py-1 px-3 m-0 my-1 fs-16">OK</button>       </div>   </div></fieldset></form>`,this.parent=document.body,this.modal=document.getElementById("modal-address-body"),this.modal.innerHTML=" ",this._createModal()}static async build(){let e=await deliveryAddress();return new AddressModal(e)}_createModal(){const e=document.createElement("div");e.classList.add("container"),this.modal.appendChild(e);const t=document.createElement("span");t.setAttribute("id","address-form"),t.innerHTML=this.html,e.appendChild(t),this.delete_button=document.getElementById("confirm-address"),this.delete_button.addEventListener("click",(()=>{let e=document.getElementById("input-address").value;event.preventDefault(),deliveryAddress(e),document.getElementById("delivery-address").innerHTML=e,this._destroyModal()})),$("#modal-address").modal("show")}_destroyModal(){$("#modal-address").modal("hide")}}async function changeDeliveryAddress(){let e=new URLSearchParams(window.location.search).get("f_pin");window.open("/nexilis/pages/tab5-change-address?f_pin="+e,"_self")}function pauseVideos(){$("video").each((function(){$(this).get(0).pause()}))}