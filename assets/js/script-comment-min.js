let xReply=1,xReffReply=10;function commentProduct(e){if(""==document.getElementById("input").value.trim()){let e="Write a comment...";return 1==localStorage.lang&&(e="Isi komentar..."),void showAlert(e)}$("input:text").click((function(){$(this).val("")}));var t="";if(""!=(t=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin"))){var n=(new Date).getTime(),o=new FormData,i=n.toString()+t;o.append("product_code",e),o.append("f_pin",t),o.append("last_update",n),o.append("comment",document.getElementById("input").value.trim()),o.append("discussion_id",i),xReply++;let a=new URLSearchParams(window.location.search).get("is_post");if(o.append("is_post",a),!document.getElementById("reply-div").classList.contains("d-none")){var s=getCookie("commentId");o.append("reply_id",s),xReffReply+=10}let l=new XMLHttpRequest;l.onreadystatechange=function(){4==l.readyState&&200==l.status&&"Success Comment"==l.responseText&&(document.getElementById("reply-div").classList.contains("d-none")||(deleteAllCookies(),$("#reply-div").addClass("d-none"),document.getElementById("content-comment").style.marginBottom="150px"),$("input#input").val(""),appendComment(o),window.scrollTo(0,document.body.scrollHeight),updateScore(e,"comment"))},l.open("post","/nexilis/logics/comment_product"),l.send(o)}}function getCookie(e){return document.cookie.length>0&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}async function appendComment(e){let t={};e.forEach(((e,n)=>t[n]=e));let n=new Date(parseInt(t.last_update)),o=n.getHours()+":"+n.getMinutes(),i=t.f_pin+t.last_update,s=await getProfpic(t.f_pin),a=await getUserName(t.f_pin),l="Reply",d="Delete";0==localStorage.lang?(l="Reply",d="Delete"):1==localStorage.lang&&(l="Balas",d="Hapus");let c=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin");if(t.hasOwnProperty("reply_id")){let e=t.reply_id,n=`\n        <div class="row comments cmt-reply" id="${i}" style="width:100%;">\n        <div class="commentId" style="display: none;">${i}</div>\n        <div class="fPin" style="display: none;">${t.f_pin}</div>\n        <div class="col-2">\n          <img onclick="window.location.href='tab3-profile?f_pin=${c}&store_id=${t.f_pin}'" id="user-thumb-reff-new-${xReffReply}" alt="Profile Photo" class="rounded-circle my-3" style="height:40px; width:40px; cursor:pointer; object-position: center; background: grey; object-fit: cover;" src="${s}">\n        </div>\n        <div class="col-10 text-break">\n          <div style="font-weight: bold;" class="mt-3 mb-1 mr-3">\n            <span id="user-name-reff-new-${xReffReply}">${a} </span>\n            <span style="font-weight: 300;"> ${t.comment}</span>\n          </div>\n          <div style="font-weight: 100; color: grey;" class="my-1">${o}&emsp; <span data-translate="comment-2" style="font-weight: 300;" onclick="onReply(true,'user-name-reff-new-${xReffReply}','${i}');">${l}</span>&emsp;<span class="text-delete" style="font-weight: 300;" onclick="showSuccessModal('${i}');">${d}</span>\n          </div>\n        </div>\n      </div>\n        `;!$(".comments#"+e).hasClass("cmt-reply")?$(".comments#"+e).append(n):$(".comments#"+e).after(n)}else{let e=document.getElementById("content-comment"),n=`\n        <div class="row mx-0 comments" id="${i}">\n            <div class="commentId" style="display: none;">${i}</div>\n            <div class="fPin" style="display: none;">${t.f_pin}</div>\n            <div class="col-2">\n            <img onclick="window.location.href='tab3-profile?f_pin=${c}&store_id=${t.f_pin}'" id="user-thumb-new-${xReply}" alt="Profile Photo" class="rounded-circle my-3" style="height:50px; width:50px; cursor:pointer; object-position: center; background: grey; object-fit: cover;" src="${s}">\n            </div>\n            <div class="col-10 text-break">\n            <div style="font-weight: bold;" class="mt-3 mb-1 mr-3">\n                <span id="user-name-new-${xReply}">${a} </span>\n                <span style="font-weight: 300;"> ${t.comment}</span>\n            </div>\n            <div style="font-weight: 100; color: grey;" class="my-1">${o}&emsp; <span style="font-weight: 300;" data-translate="comment-2" onclick="onReply(true,'user-name-new-${xReply}','${i}');">${l}</span>&emsp;<span class="text-delete" style="font-weight: 300;" onclick="showSuccessModal('${i}');">${d}</span>\n            </div>\n            </div>\n        </div>\n        `;e.innerHTML+=n}if(enableDelete(),t.hasOwnProperty("reply_id")){var r=document.getElementById(i).getBoundingClientRect().top+window.pageYOffset-45;window.scrollTo({top:r,behavior:"smooth"})}else document.getElementById(i).scrollIntoView({behavior:"smooth"})}function openDelete(e){return function(t){t.preventDefault(),t.stopPropagation(),showSuccessModal(e,void 0)}}function enableDelete(){$(".first-comment").each((function(){if(!$(this).hasClass("is-deleted")){$(this).siblings(".commentId").text();let t=$(this).siblings(".fPin").text();var e="";try{e=new URLSearchParams(window.location.search).get("f_pin")}catch(e){}if(t!=e)return;$(this).unbind("contextmenu")}})),$(".comments").each((function(){if(!$(this).hasClass("is-deleted")){$(this).find(".commentId").text();let t=$(this).find(".fPin").text();var e="";try{e=new URLSearchParams(window.location.search).get("f_pin")}catch(e){}if(t!=e)return;$(this).unbind("contextmenu")}})),toggleProdDesc()}async function showSuccessModal(e,t){event.preventDefault(),$("body").css("overflow","hidden"),this.myModal=new SuccessModal(e,t);try{await myModal.question()}catch(e){}}enableDelete();class SuccessModal{constructor(e,t=""){0==localStorage.lang?(this.modalTitle="Are you sure you want to delete this comment?",this.acceptText="Delete",this.cancelText="Cancel"):(this.modalTitle="Yakin ingin menghapus komentar ini?",this.acceptText="Hapus",this.cancelText="Batal"),this.parent=document.body,this.commentId=e,this.method=t,this.modal=void 0,this.acceptButton=void 0,this.cancelButton=void 0,this._createModal()}question(){return new Promise(((e,t)=>{this.modal&&this.acceptButton?(this.acceptButton.addEventListener("click",(()=>{var e=new FormData;e.append("comment_id",this.commentId);let t=new URLSearchParams(window.location.search).get("is_post");e.append("is_post",t);let n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&"Success Delete Comment"==n.responseText&&location.reload()},n.open("post","/nexilis/logics/delete_comment"),n.send(e)})),this.cancelButton.addEventListener("click",(()=>{this._destroyModal(),$("body").css("overflow","auto")}))):t("There was a problem creating the modal window!")}))}_createModal(){this.modal=document.createElement("dialog"),this.modal.setAttribute("style","z-index: 1031;"),this.modal.classList.add("simple-modal-dialog"),this.modal.show();const e=document.createElement("div");e.classList.add("simple-modal-window"),this.modal.appendChild(e);const t=document.createElement("div");t.classList.add("simple-modal-title"),e.appendChild(t);const n=document.createElement("span");n.classList.add("simple-modal-title-text"),n.style.marginLeft="5px",n.style.marginRight="5px",n.textContent=this.modalTitle,t.appendChild(n);const o=document.createElement("div");o.classList.add("simple-modal-button-group"),e.appendChild(o),this.acceptButton=document.createElement("button"),this.acceptButton.type="button",this.acceptButton.classList.add("simple-modal-button-green"),this.acceptButton.textContent=this.acceptText,o.appendChild(this.acceptButton),this.cancelButton=document.createElement("button"),this.cancelButton.type="button",this.cancelButton.classList.add("simple-modal-button-red"),this.cancelButton.textContent=this.cancelText,o.appendChild(this.cancelButton),this.parent.appendChild(this.modal)}_destroyModal(){this.parent.removeChild(this.modal)}}function onReply(e,t,n){if(e){$("#input").focus(),finalName=document.getElementById(t).innerHTML,0==localStorage.lang?document.getElementById("content-reply").innerHTML="Reply to "+finalName:1==localStorage.lang&&(document.getElementById("content-reply").innerHTML="Balas ke "+finalName),document.getElementById("content-comment").style.marginBottom="200px",document.cookie="commentId="+n,$("#reply-div").removeClass("d-none"),(o=500,new Promise((e=>setTimeout(e,o)))).then((()=>{window.scrollTo(0,document.body.scrollHeight)}))}else deleteAllCookies(),$("#reply-div").addClass("d-none"),document.getElementById("content-comment").style.marginBottom="200px";var o;window.scrollTo(0,document.body.scrollHeight)}function deleteAllCookies(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var n=e[t],o=n.indexOf("="),i=o>-1?n.substr(0,o):n;document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}function goBack(){window.Android,window.history.back()}function showAlert(e){window.Android&&window.Android.showAlert(e),window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.showAlert&&window.webkit.messageHandlers.showAlert.postMessage({param1:e})}function hideProdDesc(){$(".prod-desc").each((function(){if($(this).text().length>50){$(this).addClass("mb-3"),$(this).toggleClass("truncate");let e=document.createElement("span");e.innerHTML=1==localStorage.lang?"Selengkapnya...":"Read more...",e.style.color="#999999",e.classList.add("truncate-read-more"),$(this).parent().append(e)}}))}function toggleProdDesc(){$(".truncate-read-more").each((function(){$(this).off("click"),$(this).click((function(){$(this).parent().find(".prod-desc").toggleClass("truncate"),"Selengkapnya..."==$(this).text()||"Read more..."==$(this).text()?$(this).text(1==localStorage.lang?"Sembunyikan":"Hide"):$(this).text(1==localStorage.lang?"Selengkapnya...":"Read more...")}))}))}function onFocusInput(){if(window.Android)try{window.Android.onFocusInput()}catch(e){}}$((function(){toggleProdDesc(),window.Android?window.Android.tabShowHide(!1):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.tabShowHide&&window.webkit.messageHandlers.tabShowHide.postMessage({param1:!1})}));