var data=[],dataFiltered=[];let defaultCategory="",visibleCategory="";window.addEventListener("storage",(async function(){1==sessionStorage.getItem("refresh")&&(sessionStorage.removeItem("refresh"),window.location.reload())}),!1),window.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation()}));let limit=9,offset=0,busy=!1,r=Math.floor(2*Math.random())+1;var grid_stack=GridStack.init({float:!1,disableOneColumnMode:!0,column:3,margin:2.5,animate:!1}),otherFilter={friends:1,verified:1,others:0,official:1},ua=window.navigator.userAgent,palioBrowser=!!ua.match(/PalioBrowser/i),isChrome=!!ua.match(/Chrome/i),big_list=new Map;function isBig(e){var t=Math.floor(e/9);if(big_list.has(t))return big_list.get(t)==e;var i=9*t+Math.floor(8*Math.random());return big_list.set(t,i),i==e}var STORE_ID="";function loadClient(){return gapi.client.setApiKey("AIzaSyBlAojol4WmDKcloEy5OZHZa6SOkz88xEs"),gapi.client.load("https://content.googleapis.com/discovery/v1/apis/customsearch/v1/rest").then((function(){}),(function(e){}))}let cx="35bf000b4631645b5",searchSettings=[];function getSearchSettings(){let e=new XMLHttpRequest;e.open("GET","/nexilis/logics/fetch_link_category.php"),e.send(),e.onload=function(){if(200!=e.status);else{JSON.parse(e.responseText).forEach((e=>{let t={cx:cx,safe:"active",searchType:"image",code:e.CODE};1==e.EXACT_TERMS?t.exactTerms=e.QUERY:0==e.EXACT_TERMS&&(t.q=e.QUERY),null!=e.DATE_RESTRICT&&(t.dateRestrict=e.DATE_RESTRICT),null!=e.EXCLUDE_TERMS&&(t.excludeTerms=e.EXCLUDE_TERMS),searchSettings.push(t)})),fetchLinks()}},e.onerror=function(){}}async function execute(e){await executeGAPI(e),e.start=11,await executeGAPI(e)}function executeGAPI(e){return gapi.client.search.cse.list(e).then((function(e){e.result.items.forEach((e=>{let t=new URL(e.image.thumbnailLink),i=new URLSearchParams(t.search).get("q").split(":")[1],o={LINK_ID:i,TITLE:e.title,DESC:e.snippet,THUMB:e.link,CATEGORY:activeFilter,CONTEXT_LINK:e.image.contextLink};0==data.some((e=>e.LINK_ID==i))&&(o.TOTAL_LIKES=0,o.TOTAL_COMMENTS=0,data.push(o))})),filterStoreData(activeFilter,query,!1)}),(function(e){}))}function onClickHasStory(){$(".has-story").click((function(e){if(e.preventDefault(),busy=!0,"all-store"==this.id){STORE_ID="",$("#query").val(""),$("#delete-query").addClass("d-none");localStorage.getItem("active_content_classification"),localStorage.getItem("active_content_category")}else if("store-nexilis"==this.id)STORE_ID=this.id;else{STORE_ID=this.id.split("-")[1]}searchFilter()}))}function shuffle(e){for(var t,i=e.length;0!==i;)t=Math.floor(Math.random()*i),i--,[e[i],e[t]]=[e[t],e[i]];return e}var currentSort="popular";function nonEmptyMerchants(){let e=new XMLHttpRequest;e.open("GET","/nexilis/logics/non_empty_merchants.php"),e.responseType="json",e.send(),e.onload=function(){if(200!=e.status);else{let t=e.response;localStorage.setItem("non_empty_merchant",JSON.stringify(t))}},e.onerror=function(){}}function shuffleMerchants(e){let t=[];if("popular"==e){let e=dataFiltered,i=JSON.parse(localStorage.getItem("non_empty_merchant")),o=[],n=[];e.forEach((e=>{i.includes(e.CODE)?o.push(e):n.push(e)})),t=shuffle(o).concat(shuffle(n))}else if("date"==e){t=dataFiltered.sort(((e,t)=>e.CREATED_DATE>t.CREATED_DATE?-1:t.CREATED_DATE>e.CREATED_DATE?1:0))}else if("follower"==e){t=dataFiltered.sort(((e,t)=>e.TOTAL_FOLLOWER>t.TOTAL_FOLLOWER?-1:t.TOTAL_FOLLOWER>e.TOTAL_FOLLOWER?1:0))}return new Promise((function(e,i){e(t)}))}function gridCheck(e,t){return e.some((e=>e.id===t))}function shuffleArray(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}function ext(e){return(e=e.substr(1+e.lastIndexOf("/")).split("?")[0]).split("#")[0].substr(e.lastIndexOf(".")+1)}nonEmptyMerchants();var enableFollow=0,showLinkless=2,f_pin="",gridElements=[],carouselIntervalId=0;let defaultSort="popular",currentShuffle=[];var fillGridStack=async function(e,t,i,o){gridElements=[],big_list.clear();var n=["jpg","jpeg","png","webp"],a=["mp4","mov","wmv","flv","webm","mkv","gif","m4v","avi","mpg"],s=/(?:\.([^.]+))?$/;let l="";if(window.Android)try{l=window.Android.getFPin()}catch(e){}else l=new URLSearchParams(window.location.search).get("f_pin");(dataFiltered=dataFiltered.sort((()=>Math.random()-.5))).slice(o,i+1).forEach(((e,t)=>{var i;i=1==r?t%12==0||t%12==7?2:1:t%12==1||t%12==6?2:1;var o="";productImageMap.get(e.CONTEXT_LINK),e.CONTEXT_LINK;ext(e.THUMB).substr(1),e.THUMB.includes("http")&&"http"==e.THUMB.substr(0,4)||e.THUMB.includes("/nexilis/images/");let c=productImageMap.get(e.LINK_ID).filter((e=>e.length>0)),d="";if("02d7c16d7a"==e.F_PIN&&(d=""),c.length>1)c.forEach(((t,i)=>{if(t.length>0){var r="",l=s.exec(t)[1].trim();if(n.includes(l))r='<img draggable="false" class="content-image" src="'+d+"/nexilis/images/"+t.trim()+'" loading="lazy" />';else if(a.includes(l)){r=""!=e.THUMBNAIL&&null!=e.THUMBNAIL?'<video preload="metadata" muted loop playsinline draggable="false" class="content-image" poster="'+d+"/nexilis/images/"+e.THUMBNAIL.trim()+'" id="video-'+e.LINK_ID+'" src="'+d+"/nexilis/images/"+t.trim()+'#t=5" type="video/'+l+'"></video>':'<video preload="metadata" muted loop playsinline draggable="false" class="content-image" id="video-'+e.LINK_ID+'" src="'+d+"/nexilis/images/"+t.trim()+'#t=5" type="video/'+l+'"></video>'}r&&(o=0==i?o+'<div class="carousel-item active">'+r+"</div>":o+'<div class="carousel-item">'+r+"</div>")}})),contents='<div id="store-carousel-'+e.LINK_ID+'" class="carousel slide" data-bs-ride="carousel" data-bs-interval="false"><div class="carousel-inner">'+o+"</div></div>";else{var u="",p=s.exec(c[0])[1].trim();if(n.includes(p))u='<img draggable="false" class="content-image" src="'+d+"/nexilis/images/"+c[0].trim()+'" loading="lazy"/>';else if(a.includes(p)){u=""!=e.THUMBNAIL&&null!=e.THUMBNAIL?'<video preload="metadata" muted loop playsinline draggable="false" class="content-image" poster="'+d+"/nexilis/images/"+e.THUMBNAIL.trim()+'" id="video-'+e.LINK_ID+'" src="'+d+"/nexilis/images/"+c[0].trim()+'#t=5" type="video/'+p+'"></video>':'<video muted loop playsinline draggable="false" class="content-image" id="video-'+e.LINK_ID+'" src="'+d+"/nexilis/images/"+c[0].trim()+'#t=1" type="video/'+p+'"></video>'}contents=u}let f="tab3-profile?store_id="+e.F_PIN+"&f_pin="+l;var g=2==i?"big-grid":"small-grid",h="<a onclick=\"openProfile('"+f+'\')" id="'+e.LINK_ID+'"><div class="inner '+g+'">'+contents+'<div class="viewer-count" id="visitor-'+e.LINK_ID+'"><img src="/nexilis/assets/img/jim_likes_red.png" style="width:11px; height:11px; margin:auto .2rem;"/><span class="visitor-amt" style="font-size:11px; color:white">'+new Intl.NumberFormat("en-US",{maximumFractionDigits:1,notation:"compact"}).format(e.TOTAL_LIKES)+'</span><img src="/nexilis/assets/img/jim_comments_blue.png" style="width:11px; height:11px; margin:auto .2rem;"/><span class="follower-amt" style="font-size:11px; color:white">'+new Intl.NumberFormat("en-US",{maximumFractionDigits:1,notation:"compact"}).format(e.TOTAL_COMMENTS)+"</span></div></div></a>";gridCheck(gridElements,e.LINK_ID)||gridElements.push({id:e.LINK_ID,minW:i,minH:i,maxW:i,maxH:i,content:h}),busy=!1})),grid_stack.removeAll(!0),grid_stack.load(gridElements,!0),0==dataFiltered.length?$("#no-stores").removeClass("d-none"):$("#no-stores").addClass("d-none"),$(".carousel").each((function(){$(this).carousel()})),$("#stack-top").css("display","none"),$(".overlay").addClass("d-none"),checkVideoViewport(),checkVideoCarousel(),checkCarousel(),correctVideoCrop(),correctImageCrop(),addToCartModal(),attachLongPress(),carouselIntervalId&&clearInterval(carouselIntervalId),carouselIntervalId=setInterval((function(){carouselNext()}),3e3),$("#loading").addClass("d-none")};function fillGridWidgets(e,t,i,o){let n=o,a=o+i;var s=["jpg","jpeg","png","webp"],l=["mp4","mov","wmv","flv","webm","mkv","gif","m4v","avi","mpg"],c=["17b0ae770cd"],d=/(?:\.([^.]+))?$/;let u="";if(window.Android)try{u=window.Android.getFPin()}catch(e){}else u=new URLSearchParams(window.location.search).get("f_pin");dataFiltered.slice(n,a).forEach(((e,t)=>{if(c.includes(e.CODE))return;var i;i=0==r?t%12==0||t%12==7?2:1:t%12==1||t%12==6?2:1;var o="";productImageMap.get(e.CONTEXT_LINK),e.CONTEXT_LINK;let n=e.THUMB,a=(ext(n).substr(1),e.THUMB.includes("http")&&"http"==e.THUMB.substr(0,4)||e.THUMB.includes("/nexilis/images/"),n.split("|").filter((e=>e.length>0))),p="";if("02d7c16d7a"==e.F_PIN&&(p=""),a.length>1)a.forEach(((t,i)=>{if(t.length>0){var n="",a=d.exec(t)[1].trim();if(s.includes(a))n='<img draggable="false" class="content-image" src="'+p+"/nexilis/images/"+t.trim()+'" loading="lazy"/>';else if(l.includes(a)){n=""!=e.THUMBNAIL&&null!=e.THUMBNAIL?'<video preload="metadata" muted loop playsinline draggable="false" class="content-image" poster="'+p+"/nexilis/images/"+e.THUMBNAIL.trim()+'" id="video-'+e.LINK_ID+'" src="'+p+"/nexilis/images/"+t.trim()+'#t=5" type="video/'+a+'"></video>':'<video preload="metadata" muted loop playsinline draggable="false" class="content-image" id="video-'+e.LINK_ID+'" src="'+p+"/nexilis/images/"+t.trim()+'#t=5" type="video/'+a+'"></video>'}n&&(o=0==i?o+'<div class="carousel-item active">'+n+"</div>":o+'<div class="carousel-item">'+n+"</div>")}})),contents='<div id="store-carousel-'+e.LINK_ID+'" class="carousel slide" data-bs-ride="carousel" data-bs-interval="false"><div class="carousel-inner">'+o+"</div></div>";else{var f="",g=d.exec(a[0])[1].trim();if(s.includes(g))f='<img draggable="false" class="content-image" src="'+p+"/nexilis/images/"+a[0].trim()+'" loading="lazy"/>';else if(l.includes(g)){f=""!=e.THUMBNAIL&&null!=e.THUMBNAIL?'<video preload="metadata" muted loop playsinline draggable="false" class="content-image" poster="'+p+"/nexilis/images/"+e.THUMBNAIL.trim()+'" id="video-'+e.LINK_ID+'" src="'+p+"/nexilis/images/"+a[0].trim()+'#t=5" type="video/'+g+'"></video>':'<video muted loop playsinline draggable="false" class="content-image" id="video-'+e.LINK_ID+'" src="'+p+"/nexilis/images/"+a[0].trim()+'#t=1" type="video/'+g+'"></video>'}contents=f}let h="tab3-profile?store_id="+e.F_PIN+"&f_pin="+u;var m=2==i?"big-grid":"small-grid",w="<a onclick=\"openProfile('"+h+'\')" id="'+e.LINK_ID+'"><div class="inner '+m+'">'+contents+'<div class="viewer-count" id="visitor-'+e.LINK_ID+'"><img src="/nexilis/assets/img/jim_likes_red.png" style="width:11px; height:11px; margin:auto .2rem;"/><span class="visitor-amt" style="font-size:11px; color:white">'+new Intl.NumberFormat("en-US",{maximumFractionDigits:1,notation:"compact"}).format(e.TOTAL_LIKES)+'</span><img src="/nexilis/assets/img/jim_comments_blue.png" style="width:11px; height:11px; margin:auto .2rem;"/><span class="follower-amt" style="font-size:11px; color:white">'+new Intl.NumberFormat("en-US",{maximumFractionDigits:1,notation:"compact"}).format(e.TOTAL_COMMENTS)+"</span></div></div></a>";gridCheck(gridElements,e.LINK_ID)||(gridElements.push({id:e.LINK_ID,minW:i,minH:i,maxW:i,maxH:i,content:w}),grid_stack.addWidget({id:e.LINK_ID,minW:i,minH:i,maxW:i,maxH:i,content:w}))})),grid_stack.compact(),0==dataFiltered.length?$("#no-stores").removeClass("d-none"):$("#no-stores").addClass("d-none"),$(".carousel").each((function(){$(this).carousel()})),$("#stack-top").css("display","none"),$(".overlay").addClass("d-none"),checkVideoViewport(),checkVideoCarousel(),checkCarousel(),correctVideoCrop(),correctImageCrop(),addToCartModal(),attachLongPress(),busy=!1,carouselIntervalId&&clearInterval(carouselIntervalId),carouselIntervalId=setInterval((function(){carouselNext()}),3e3)}var nextCarouselIdx=0,carouselList=[];function carouselNext(){if(carouselList.length<=0)return;let e=nextCarouselIdx;for(;!$(carouselList[nextCarouselIdx]).is(":in-viewport")&&((nextCarouselIdx+=1)>=carouselList.length&&(nextCarouselIdx=0),nextCarouselIdx!=e););$(carouselList[nextCarouselIdx]).carousel("next"),(nextCarouselIdx+=1)>=carouselList.length&&(nextCarouselIdx=0)}function correctVideoCrop(){document.querySelectorAll("video.content-image").forEach((function(e){e.addEventListener("loadedmetadata",(function(){e.videoWidth>e.videoHeight&&e.classList.add("landscape")}))}))}function pauseAllVideo(){$(".grid-stack-item .carousel-item video, .grid-stack-item .carousel-item.active video").each((function(){let e=$(this).get(0).paused;$(this).off("stop pause ended"),e||$(this).get(0).pause()}))}function playAllVideo(){$(".grid-stack-item .carousel-item video, .grid-stack-item .carousel-item.active video").each((function(){$(this).get(0).play(),$(this).parent().find(".video-play").addClass("d-none")}))}let popUpModal=document.getElementById("modal-product");function toggleVideoMute(e){let t=document.getElementById(e).querySelector("video"),i=document.querySelector("#"+e+" .video-sound img");t.muted?(t.muted=!1,i.src="../assets/img/video_unmute.png"):(t.muted=!0,i.src="../assets/img/video_mute.png")}var onlongtouch,timer;popUpModal.addEventListener("show.bs.modal",(function(e){pauseAllVideo()})),popUpModal.addEventListener("shown.bs.modal",(function(){if(tooSoon)closeModal();else{document.querySelectorAll(".carousel-item.active .video-wrap, .video-wrap").forEach((function(e){e.querySelector("video");(e=>!!(e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2&&e.muted))&&toggleVideoMute(e.id)}))}tooSoon=!1})),popUpModal.addEventListener("hide.bs.modal",(function(){let e=document.querySelector("#modal-product .modal-body video");e&&(e.pause(),e.removeAttribute("src"),e.load())})),popUpModal.addEventListener("hidden.bs.modal",(function(){$("#modal-product .modal-body").html(""),window.Android&&window.Android.setIsProductModalOpen(!1),window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.setIsProductModalOpen&&window.webkit.messageHandlers.setIsProductModalOpen.postMessage({param1:!1}),modalIsOpen=!1,checkVideoViewport()}));var touchduration=750;let startTouchTime=0,currentTouchTime=0,tooSoon=!1;function attachLongPress(){Array.from(document.querySelectorAll("div.grid-stack-item-content a")).forEach((function(e){e.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation()}));let t=!1;e.addEventListener("touchstart",(function(i){i.stopPropagation(),startTouchTime=(new Date).getTime(),timer||(timer=setTimeout((function(){t||showProductModal(e.id)}),touchduration))}),!1),e.addEventListener("touchend",(function(){t=!1,currentTouchTime=(new Date).getTime();let e=currentTouchTime-startTouchTime;timer&&(closeModal(),startTouchTime=0,currentTouchTime=0),e<1500&&(tooSoon=!0),clearTimeout(timer),timer=null}),!1)}))}function correctImageCrop(){document.querySelectorAll("img.content-image").forEach((function(e){e.addEventListener("load",(function(){e.width>e.height&&e.classList.add("landscape")}))}))}function openStore(e,t){if(window.Android){if(storeMap.has(e)){var i=storeMap.get(e),o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){if(200==o.status){let e=JSON.parse(o.responseText);storeData=JSON.stringify(e[0])}window.Android.openStore(i)}},o.open("get","/nexilis/logics/fetch_stores_specific?store_id="+e),o.send()}}else window.location.href=t}function openStoreMenu(e,t){if(window.Android&&storeMap.has(e)){var i=storeMap.get(e);window.Android.openStoreMenu(i)}}function fetchRewardPoints(){var e=new XMLHttpRequest;if(e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){let t=JSON.parse(e.responseText);t.length>0&&t.forEach((e=>{let t=dataFiltered.findIndex((t=>t.CODE==e.STORE_CODE));dataFiltered[t].REWARD_PTS=e.AMOUNT}))}},window.Android){var t=window.Android.getFPin();t?e.open("get","/nexilis/logics/fetch_stores_reward_user_raw?f_pin="+t):e.open("get","/nexilis/logics/fetch_stores_reward_user_raw")}else e.open("get","/nexilis/logics/fetch_stores_reward_user_raw");e.send()}let countVideoPlaying=0;var visibleCarousel=new Set;function checkVideoViewport(){let e=document.querySelectorAll(".big-grid"),t=[].slice.call(e).reverse(),i=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>=.8&&$("#modal-product").not(".show")&&0===countVideoPlaying?function(e,t){let i=e.querySelector("video");e.querySelector(".carousel");null!=i&&i.paused&&(i.play(),countVideoPlaying=1)}(e.target,e.intersectionRatio):e.intersectionRatio<.8&&function(e,t){let i=e.querySelector("video");e.querySelector(".carousel");null==i||i.paused||(i.pause(),countVideoPlaying=0)}(e.target,e.intersectionRatio)}))}),{threshold:1});t.forEach((e=>{i.observe(e)}))}function checkVideoCarousel(){}visibleCarousel=new Set;function checkCarousel(){$(".carousel").each((function(){$(this).is(":in-viewport")?visibleCarousel.has($(this).attr("id"))||(visibleCarousel.add($(this).attr("id")),$(this).carousel("cycle")):visibleCarousel.has($(this).attr("id"))&&(visibleCarousel.delete($(this).attr("id")),$(this).carousel("pause"))}))}function showHideFilter(e){e?($("#category-checkbox").removeClass("d-none"),$("#toggle-filter").attr("src","../assets/img/filter-icon-black.png"),isSearchHidden=!1):($("#category-checkbox").addClass("d-none"),$("#toggle-filter").attr("src","../assets/img/filter-icon-gray.png"),isSearchHidden=!0,selectCategoryFilter())}$(window).focus((function(){refreshId=setInterval((function(){}),1e4),carouselIntervalId&&clearInterval(carouselIntervalId),carouselIntervalId=setInterval((function(){carouselNext()}),3e3)})),$(window).blur((function(){clearInterval(refreshId),carouselIntervalId&&(clearInterval(carouselIntervalId),carouselIntervalId=0)}));var refreshId=0;$((function(){$(window).scroll((function(){scrollFunction(),didScroll=!0,checkVideoViewport(),checkVideoCarousel(),checkCarousel()})),null!==localStorage.getItem("store_data")&&prefetchStores(),getShowLinklessSetting(),getLikedProducts(),getCommentedProducts(),$("#toggle-filter").click((function(e){e.stopPropagation(),window.scrollTo({top:0,behavior:"instant"}),showHideFilter($("#category-checkbox").hasClass("d-none")),$("#header-layout").css("top","0px")}))}));var storeMap=new Map;function prefetchStores(){data=JSON.parse(localStorage.getItem("store_data")),filterStoreData(defaultCategory,"",STORE_ID,otherFilter.verified,otherFilter.friends,otherFilter.others,!1),dataFiltered.forEach((e=>{storeMap.set(e.CODE,JSON.stringify(e))})),(dataFiltered=(dataFiltered=[]).concat(data)).forEach((e=>{if($thumb_ids=e.THUMB,!productImageCountMap.has(e.LINK_ID)){{let t=$thumb_ids.split("|"),i=[];t.forEach(((e,t)=>{if(!e.startsWith("http")){location.host;if(null!=e&&""!=e){let t=e;i.push(t)}}})),productImageMap.set(e.LINK_ID,i)}productImageCountMap.has(e.LINK_ID)?productImageCountMap.set(e.LINK_ID,productImageCountMap.get(e.LINK_ID)+1):productImageCountMap.set(e.LINK_ID,1)}}))}function getFollowSetting(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(dataFollowSetting=JSON.parse(e.responseText),enableFollow=dataFollowSetting)},e.open("get","/nexilis/logics/fetch_stores_settings?param=stats"),e.send()}function getShowLinklessSetting(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(dataShowLinklessSetting=JSON.parse(e.responseText),showLinkless=dataShowLinklessSetting)},e.open("get","/nexilis/logics/fetch_stores_settings?param=show_linkless"),e.send()}function fetchLinks(){let e="";e=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin");var t=new XMLHttpRequest;t.onreadystatechange=async function(){if(4==t.readyState&&200==t.status){if(0==(data=JSON.parse(t.responseText)).length);else{let e=new URLSearchParams(window.location.search).get("store_id");null!=e&&(STORE_ID=e.toString()),filterStoreData(defaultCategory,query,STORE_ID,otherFilter.official,otherFilter.verified,otherFilter.friends,otherFilter.others,!1)}localStorage.setItem("store_data",t.responseText),fetchProductPics(data)}},t.open("get","/nexilis/logics/fetch_links?f_pin="+e),t.send()}function updateStoreViewer(){var e=new XMLHttpRequest;if(e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){JSON.parse(e.responseText).forEach((e=>{e.IS_LIVE_STREAMING>0?$("#live-"+e.CODE).removeClass("d-none"):$("#live-"+e.CODE).addClass("d-none"),$("#visitor-"+e.CODE+" span.visitor-amt").html(""+new Intl.NumberFormat("en-US",{maximumFractionDigits:1,notation:"compact"}).format(e.TOTAL_VISITOR)),$("#visitor-"+e.CODE+" span.follower-amt").html(""+new Intl.NumberFormat("en-US",{maximumFractionDigits:1,notation:"compact"}).format(e.TOTAL_FOLLOWER))}))}},window.Android){var t=window.Android.getFPin();t?e.open("get","/nexilis/logics/fetch_stores?f_pin="+t):e.open("get","/nexilis/logics/fetch_stores")}else e.open("get","/nexilis/logics/fetch_stores");e.send()}var productImageMap=new Map,productImageCountMap=new Map;function saveLinks(e){let t=[];e.forEach((e=>{let i={LINK_ID:e.LINK_ID,TITLE:e.TITLE,DESC:e.DESC,THUMB:e.THUMB,CATEGORY:e.CATEGORY,CONTEXT_LINK:e.CONTEXT_LINK,CREATED_AT:(new Date).getTime()};t.push(i)}));let i=new FormData;i.append("rows",btoa(unescape(encodeURIComponent(JSON.stringify(t)))));let o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&o.status},o.open("post","/nexilis/logics/add_search_result"),o.send(i)}function fetchProductPics(e){e.forEach((e=>{if($thumb_ids=e.THUMB,!productImageCountMap.has(e.LINK_ID)){{let t=$thumb_ids.split("|"),i=[];t.forEach(((e,t)=>{if(!e.startsWith("http")){location.host;if(null!=e&&""!=e){let t=e;i.push(t)}}})),productImageMap.set(e.LINK_ID,i)}productImageCountMap.has(e.LINK_ID)?productImageCountMap.set(e.LINK_ID,productImageCountMap.get(e.LINK_ID)+1):productImageCountMap.set(e.LINK_ID,1)}})),fillGridStack("#content-grid",currentSort,limit,offset)}var hiddenStores=[];function filterStoreData(e,t,i,o,n,a,r,s){if(window.Android)try{hiddenStores=window.Android.getHiddenStores().split(",")}catch(e){}let l=[...data];if(e){var c=e.split("-");l=l.filter((e=>c.indexOf(e.CATEGORY+"")>-1))}i&&(l=l.filter((e=>e.F_PIN==i))),t&&(l=l.filter((e=>e.TITLE.toLowerCase().includes(t.toLowerCase())||e.DESC.toLowerCase().includes(t.toLowerCase())||e.USERNAME.toLowerCase().includes(t.toLowerCase()))));let d=[],u=[],p=[],f=[],g=[],h=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin");d=l.filter((e=>e.F_PIN==h)),1==parseInt(o)&&(u=l.filter((e=>1==e.OFFICIAL_ACCOUNT||3==e.OFFICIAL_ACCOUNT))),1==parseInt(n)&&(p=l.filter((e=>2==e.OFFICIAL_ACCOUNT))),1==parseInt(a)&&(f=l.filter((e=>1==e.IS_FRIEND))),1==parseInt(r)&&(g=l.filter((e=>2!=e.OFFICIAL_ACCOUNT&&1!=e.OFFICIAL_ACCOUNT&&0==e.IS_FRIEND)));let m=u.concat(p,d,f,g);dataFiltered=[...new Set(m)]}function visitStore(e,t,i){var o=new FormData;if(o.append("store_code",e),o.append("f_pin",t),o.append("flag_visit",i?1:0),e&&t){let t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let i=JSON.parse(t.responseText);$("#visitor-"+e+" span").html(""+new Intl.NumberFormat("en-US",{maximumFractionDigits:1,notation:"compact"}).format(i[0].TOTAL_VISITOR))}},t.open("post","/nexilis/logics/visit_store"),t.send(o)}}var didScroll,mouseY=0,startMouseY=0,isSearchHidden=!0,lastScrollTop=0,delta=1,navbarHeight=$("#header-layout").outerHeight(),topPosition=0;function headerOut(){$("#category-checkbox").addClass("d-none"),navbarHeight=$("#header-layout").outerHeight(),$("#header-layout").css("top","0px"),isSearchHidden=!0}let headerHeight=$("#header-layout").outerHeight();function hasScrolled(){var e=$(this).scrollTop();Math.abs(lastScrollTop-e)<=delta||(e>lastScrollTop&&e>navbarHeight?$("#header-layout").css("top",-headerHeight+"px"):e+$(window).height()<$(document).height()&&$("#header-layout").css("top","0px"),lastScrollTop=e)}setInterval((function(){didScroll&&(hasScrolled(),didScroll=!1)}),10);var finishScrollPos=0;function scrollFunction(){$(document).scrollTop()>navbarHeight?$("#scroll-top").css("display","block"):$("#scroll-top").css("display","none")}function topFunction(e){e?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0})}function checkSwitch(e){$("#switchAll").prop("checked",e)}function fillFilter(){var e=window.location.href,t=new URL(e),i=t.searchParams.get("query");null!=i&&$("#query").val(i);var o=t.searchParams.get("filter");null!=o&&(filterArr=o.split("-"),filterArr.forEach((e=>{$("#checkboxFilter-"+e).prop("checked",!0)})))}function resetFilter(){if(activeFilter="",query="",$("#query").val(""),$("#delete-query").addClass("d-none"),otherFilter.verified=1,otherFilter.friends=1,otherFilter.others=0,otherFilter.official=1,$("#filter-verified").prop("checked",!0),$("#filter-friends").prop("checked",!0),$("#filter-others").prop("checked",!1),$("#filter-official").prop("checked",!0),""!=defaultCategory){let e=defaultCategory.split("-"),t=visibleCategory.split("-");""==activeFilter&&(e.forEach((e=>{$("#root-category input#"+e).prop("checked",!0)})),"347"===BE_ID&&(activeFilter=defaultCategory.replaceAll(",","-")));try{"347"===BE_ID&&$("#root-category ul li").each((function(){let e=$(this).attr("id").split("-")[1];t.includes(e)||$(this).addClass("d-none")}))}catch(e){}}else $("#root-category input:checkbox").each((function(){$(this).prop("checked",!1)}));searchFilter()}function changeBg(e){let t=document.querySelector(".demo-bg");t.src="313"==e?"../assets/img/nxsport_bg/bg3.png":"314"==e?"../assets/img/nxsport_bg/bg2.png":"315"==e?"../assets/img/nxsport_bg/bg4.png":"316"==e?"../assets/img/nxsport_bg/bg5.png":"317"==e?"../assets/img/nxsport_bg/bg6.png":"../assets/img/nxsport_bg/bg1.png"}$((function(){$(window).scroll((function(){finishScrollPos=$(document).scrollTop(),isSearchHidden||0==finishScrollPos||($("#category-checkbox").addClass("d-none"),$("#toggle-filter").attr("src","../assets/img/filter-icon-gray.png")),scrollFunction(),didScroll=!0}))})),$("#switchAll").click((function(){setFilterCheckedAll($("#switchAll").is(":checked"))})),$(".checkbox-filter-cat").click((function(){$(this).is(":checked")?isFilterCheckedAll()&&checkSwitch(!0):checkSwitch(!1)}));let activeFilter=new URLSearchParams(window.location.search).get("filter")?new URLSearchParams(window.location.search).get("filter"):"",query=$("#query").val();function horizontalScrollPos(e){let t=0;try{t=document.querySelector(".has-story#store-"+e).offsetLeft}catch(e){}$("#story-container ul").animate({scrollLeft:t})}function highlightStore(){selected_id=""!=STORE_ID?"#store-"+STORE_ID:"#all-store",$(".has-story").removeClass("selected"),$(selected_id).addClass("selected"),horizontalScrollPos(STORE_ID)}function hasStoreId(){for(var e="",t=location.search.substr(1).split("&"),i=0;i<t.length;i++)t[i].includes("store_id=")&&(e=t[i].split("=")[1],STORE_ID=e),t[i].includes("filter=")&&(e=t[i].split("=")[1],FILTERS=e);highlightStore();const o=$("#all-store").position().left;if($("#story-container ul").scrollLeft(o),location.href.includes("#product")){var n="#"+location.href.split("#")[1];$(n)[0].scrollIntoView()}}function searchFilter(){$("body").css("visibility","hidden"),setTimeout((function(){dataFiltered=[];var e="",t="timeline_story_container_grid";query=$("#query").val();var i,o=activeFilter;window.Android?(i=window.Android.getFPin())&&(e=e+"?f_pin="+i):(i=new URLSearchParams(window.location.search).get("f_pin"))&&(e=e+"?f_pin="+i);if(""!=STORE_ID&&(e=e+"&store_id="+STORE_ID),""!=query){encodeURIComponent(query);e=e+"&query="+query}if(""!=o){e=e+"&filter="+encodeURIComponent(o)}t+=e=(e=(e=(e=e+"&official="+otherFilter.official)+"&verified="+otherFilter.verified)+"&friends="+otherFilter.friends)+"&others="+otherFilter.others,history.pushState({search:query,filter:o},"Palio Browser",e),offset=0,r=Math.floor(2*Math.random())+1,$("#story-container").html(""),$.get(t,(function(e){$("#story-container").html(e),hasStoreId(),onClickHasStory()})),filterStoreData(o,query,STORE_ID,otherFilter.official,otherFilter.verified,otherFilter.friends,otherFilter.others,!0),fillGridStack("#content-grid",currentSort,limit,offset),$("body").css("visibility","visible")}),500)}function selectCategoryFilter(){let e=[];if($("#root-category input:checked").each((function(){e.push($(this).attr("id"))})),e.length>0)activeFilter=e.join("-");else{activeFilter="";let e=[],t=defaultCategory.split("-");"347"==BE_ID?$("#root-category input:checkbox").each((function(){t.includes($(this).attr("id"))&&($(this).prop("checked",!0),e.push($(this).attr("id")))})):$("#root-category input:checkbox").each((function(){$(this).prop("checked",!0),e.push($(this).attr("id"))})),activeFilter=e.join("-")}$("#other-category li input").each((function(){otherFilter.verified=$("#filter-verified").is(":checked")?1:0,otherFilter.friends=$("#filter-friends").is(":checked")?1:0,otherFilter.others=$("#filter-others").is(":checked")?1:0,otherFilter.official=$("#filter-official").is(":checked")?1:0})),searchFilter()}function activeCategoryTab(){let e=new URLSearchParams(window.location.search).get("filter");if($("#filter-friends").prop("checked",1==otherFilter.friends),$("#filter-verified").prop("checked",1==otherFilter.verified),$("#filter-others").prop("checked",1==otherFilter.others),$("#filter-official").prop("checked",1==otherFilter.official),null==e)e="",activeFilter=e;else{activeFilter=e,e.split("-").forEach((e=>{$("#root-category input#"+e).prop("checked",!0)}))}}function voiceSearch(){window.Android?($isVoice=window.Android.toggleVoiceSearch(),toggleVoiceButton($isVoice)):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.toggleVoiceSearch&&window.webkit.messageHandlers.toggleVoiceSearch.postMessage({param1:""})}function submitVoiceSearch(e){$("#query").val(e),$("#delete-query").removeClass("d-none"),searchFilter()}function toggleVoiceButton(e){e?$("#voice-search").attr("src","../assets/img/action_mic_blue.png"):$("#voice-search").attr("src","../assets/img/action_mic.png")}function pauseAll(){$(".carousel-item video, .timeline-image video").each((function(){$(this).get(0).pause()})),visibleCarousel.clear(),$(".carousel").each((function(){$(this).carousel("pause")})),carouselIntervalId&&(clearInterval(carouselIntervalId),carouselIntervalId=0),countVideoPlaying=0,searchFilter()}function resumeAll(){checkVideoViewport(),checkVideoCarousel(),checkCarousel(),carouselIntervalId&&clearInterval(carouselIntervalId),carouselIntervalId=setInterval((function(){carouselNext()}),3e3)}function hideSortDropdown(){$("#stack-top").css("display","none"),$("#grid-overlay").addClass("d-none")}async function changeSort(e){currentSort=e,currentShuffle=await shuffleMerchants(e),offset=0,fillGridStack("#content-grid",currentSort,limit,offset)}function eraseQuery(){let e=new URLSearchParams(window.location.search).get("query");(""!=$("#searchFilterForm-a input#query").val()||null!=e&&""!=e)&&($("#delete-query").removeClass("d-none"),document.getElementById("delete-query").classList.remove("d-none")),$("#delete-query").click((function(){$("#searchFilterForm-a input#query").val(""),$("#delete-query").addClass("d-none"),searchFilter()})),$("#searchFilterForm-a input#query").keyup((function(){""!=$(this).val()?$("#delete-query").removeClass("d-none"):$("#delete-query").addClass("d-none")}))}function resetSearch(){}function checkDupes(){let e=document.querySelectorAll("#content-grid>div[gs-id]"),t={},i=e.length;for(let o=0;o<i;o++){let i=e[o].gridstackNode.id?e[o].gridstackNode.id:"undefined";isNaN(t[i])&&(t[i]=0),t[i]++}}function checkDupesDataFiltered(){let e=dataFiltered,t={},i=e.length;for(let o=0;o<i;o++){let i=e[o].LINK_ID?e[o].LINK_ID:"undefined";isNaN(t[i])&&(t[i]=0),t[i]++}}function updateCartCounter(){let e=0;if(null!=localStorage.getItem("cart"))var t=JSON.parse(localStorage.getItem("cart"));else t=[];t.forEach((t=>{t.items.forEach((t=>{e+=parseInt(t.itemQuantity)}))})),0!=e?($("#cart-counter").removeClass("d-none"),$("#cart-counter").html(e)):$("#cart-counter").addClass("d-none")}function onFocusSearch(){if(window.Android)try{window.Android.onFocusSearch()}catch(e){}}function getShopFromCrawler(e,t,i){JSON.parse(e).forEach((e=>{0==t.some((t=>t.LINK_ID==e.LINK_ID))&&(e.TOTAL_LIKES=0,e.TOTAL_COMMENTS=0,e.DESC=e.TITLE,e.CATEGORY="5",t.push(e))})),filterStoreData(activeFilter,i?url:search,i)}function pullShopFromCrawler(e,t,i){let o=e.split(" "),n="";n=o.length>1?o.join("+"):o[0];let a="https://www.google.com/search?tbm=shop&q="+n;window.Android?window.Android.pullShopFromCrawler(a,i):$.get(a,(function(o){let n=(new DOMParser).parseFromString(o,"text/html").getElementsByClassName("shntl sh-np__click-target");Array.from(n).forEach((e=>{let i=e.getElementsByClassName("SirUVb sh-img__image")[0].querySelector("img").src,o=e.getElementsByClassName("sh-np__product-title")[0].textContent,n="https://www.google.com"+e.getAttribute("href");if(i.startsWith("http")){let e=new URLSearchParams(new URL(i).search).get("q").split(":")[1],a={LINK_ID:e,TITLE:o,DESC:o,THUMB:i,CATEGORY:"5",CONTEXT_LINK:n};0==t.some((t=>t.LINK_ID==e))&&(a.TOTAL_LIKES=0,a.TOTAL_COMMENTS=0,t.push(a))}})),filterStoreData(activeFilter,i?e:search,i)}))}function checkButtonPos(){let e=document.querySelector(".prod-addtocart");e.getBoundingClientRect().bottom>(window.innerHeight||document.documentElement.clientHeight)?e.style.bottom=e.offsetHeight+20+"px":e.style.bottom="25px"}function pullRefresh(){window.Android&&0==$(window).scrollTop()&&window.scrollTo(0,document.body.scrollHeight-(document.body.scrollHeight-3))}function pauseAllVideo(){$(".timeline-main .carousel-item video, .timeline-image video").each((function(){$(this).off("stop pause ended"),$(this).on("stop pause ended",(function(e){$(this).closest(".carousel").carousel()})),$(this).get(0).pause()}))}function playAllVideo(){$(".timeline-main .carousel-item video, .timeline-image video").each((function(){$(this).off("play"),$(this).on("play",(function(e){$(this).closest(".carousel").carousel("pause")})),$(this).get(0).play(),$(this).parent().find(".video-play").addClass("d-none")}))}function playModalVideo(){$("#modal-addtocart .addcart-img-container video").each((function(){$(this).off("play"),$(this).on("play",(function(e){$(this).closest(".carousel").carousel("pause")})),$(this).get(0).play(),$(this).parent().find(".video-play").addClass("d-none")}))}$("#searchFilterForm-a").validate({rules:{},messages:{},submitHandler:function(e){searchFilter()},errorClass:"help-block",errorPlacement:function(e,t){}}),$("#sort-store-popular").click((async function(){currentSort="popular",currentShuffle=await shuffleMerchants(currentSort),offset=0,fillGridStack("#content-grid",currentSort,limit,offset),$("#sort-store-popular .check-mark").removeClass("d-none"),$("#sort-store-date .check-mark").addClass("d-none"),$("#sort-store-follower .check-mark").addClass("d-none")})),$("#sort-store-date").click((async function(){currentSort="date",currentShuffle=await shuffleMerchants(currentSort),offset=0,fillGridStack("#content-grid",currentSort,limit,offset),$("#sort-store-popular .check-mark").addClass("d-none"),$("#sort-store-date .check-mark").removeClass("d-none"),$("#sort-store-follower .check-mark").addClass("d-none")})),$("#sort-store-follower").click((async function(){currentSort="follower",currentShuffle=await shuffleMerchants(currentSort),offset=0,fillGridStack("#content-grid",currentSort,limit,offset),$("#sort-store-popular .check-mark").addClass("d-none"),$("#sort-store-date .check-mark").addClass("d-none"),$("#sort-store-follower .check-mark").removeClass("d-none")})),$((function(){gapi.load("client");let e=new URLSearchParams(window.location.search).get("filter");null!=e?($("#categoryFilter-"+e).addClass("active"),$(".nav-link:not(#categoryFilter-"+e+")").removeClass("active")):($("#categoryFilter-all").addClass("active"),$(".nav-link:not(#categoryFilter-all)").removeClass("active"));let t=document.getElementById("stack-top");$("#grid-overlay").click((function(){"block"==t.style.display&&(t.style.display="none",$("#grid-overlay").addClass("d-none"))})),eraseQuery(),$("form#searchFilterForm-a").get(0).reset(),$("#delete-query").addClass("d-none")}));var commentedProducts=[];function getCommentedProducts(){var e="";if(""!=(e=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin"))){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){JSON.parse(t.responseText).forEach((e=>{var t=e.POST_ID;commentedProducts.push(t),$(".comment-icon-"+t).attr("src","../assets/img/jim_comments_blue.png")}))}},t.open("get","/nexilis/logics/fetch_products_commented?f_pin="+e),t.send()}}function addToCartModal(){const e=parseInt($("#header-layout").offset().top+$("#header-layout").outerHeight(!0))+"px",t=JSON.parse(JSON.stringify(e));parseInt(t.replace("px",""));window.navigator.userAgent;$("#modal-addtocart").on("shown.bs.modal",(function(){$(".modal").css("overflow","hidden"),$(".modal").css("overscroll-behavior-y","contain"),checkButtonPos(),pullRefresh(),pauseAllVideo(),playModalVideo(),window.Android&&window.Android.setIsProductModalOpen(!0)})),$(".grid-stack-item-content a").click((function(){$("#modal-addtocart .modal-dialog").css("top","55px"),$("#modal-addtocart .modal-dialog").css("height",window.innerHeight-t)})),$("#modal-addtocart").on("hidden.bs.modal",(function(){$(".modal").css("overflow","auto"),$(".modal").css("overscroll-behavior-y","auto"),$("#modal-addtocart").find("video").length>0&&$("#modal-addtocart .modal-body video").get(0).pause(),pullRefresh(),checkVideoViewport(),window.Android&&window.Android.setIsProductModalOpen(!1)}))}var likedPost=[];function likeProduct(e,t){var i=parseInt($("#like-counter-"+e).text()),o=!1;window.Android?window.Android.checkProfile()&&(likedPost.includes(e)?(likedPost=likedPost.filter((t=>t!==e)),$("#like-"+e).attr("src","../assets/img/jim_likes.png"),i>0&&$("#like-counter-"+e).text(i-1),o=!1):(likedPost.push(e),$("#like-"+e).attr("src","../assets/img/jim_likes_red.png"),$("#like-counter-"+e).text(i+1),o=!0)):likedPost.includes(e)?(likedPost=likedPost.filter((t=>t!==e)),$("#like-"+e).attr("src","../assets/img/jim_likes.png"),i>0&&$("#like-counter-"+e).text(i-1),o=!1):(likedPost.push(e),$("#like-"+e).attr("src","../assets/img/jim_likes_red.png"),$("#like-counter-"+e).text(i+1),o=!0);var n="";n=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin");var a=(new Date).getTime(),r=new FormData;r.append("product_code",e),r.append("f_pin",n),r.append("last_update",a),r.append("flag_like",o?1:0),r.append("is_post",t);let s=new XMLHttpRequest;s.onreadystatechange=function(){4==s.readyState&&s.status},window.Android?window.Android.checkProfile()&&(s.open("post","/nexilis/logics/like_product"),s.send(r)):(s.open("post","/nexilis/logics/like_product"),s.send(r))}function openComment(e,t,i){if(window.Android){if(window.Android.checkProfile()){let i=window.Android.getFPin();window.location="comment.php?product_code="+e+"&is_post="+t+"&f_pin="+i}}else{let i=new URLSearchParams(window.location.search).get("f_pin");window.location="comment.php?product_code="+e+"&is_post="+t+"&f_pin="+i}}function getLikedProducts(){var e="";if(""!=(e=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin"))){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){JSON.parse(t.responseText).forEach((e=>{var t=e.PRODUCT_CODE;likedPost.push(t),$("#like-"+t).attr("src","../assets/img/jim_likes_red.png")}))}},t.open("get","/nexilis/logics/fetch_products_liked?f_pin="+e),t.send()}}function changeLayout(){let e=document.getElementById("to-grid-layout"),t=document.getElementById("to-list-layout"),i="";i=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin"),e&&t&&(e.addEventListener("click",(function(){window.Android&&window.Android.setStateContentMode(1),localStorage.setItem("is_grid","1"),window.location="tab3-main.php?f_pin="+i})),t.addEventListener("click",(function(){window.Android&&window.Android.setStateContentMode(0),localStorage.setItem("is_grid","0"),window.location="tab1-main.php?f_pin="+i})))}let gif_arr=[],gif_pos=[0,1];function getGIFs(){let e="";e=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin");let t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){gif_arr=JSON.parse(t.responseText);let e=gif_arr;3===gif_arr.length&&(e=[gif_arr[1],gif_arr[0],gif_arr[2]]),e.length>0&&drawGIFs(e)}},t.open("get","/nexilis/logics/fetch_gifs?f_pin="+e),t.send()}function drawGIFs(e){let t=parseInt(localStorage.getItem("last_ad"));null==t&&(t=0);let i=0;i=t+1<=e.length-1?t+1:0;let o="";o=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin"),localStorage.setItem("last_ad",i);let n=e[i],a=(window.location.href,"");if(n.URL.includes("bni.co.id"))a=n.URL;else{let e=window.location.pathname.split("/");e.includes("tab3-main")?a=n.URL+"&f_pin="+o+"&origin=3":e.includes("tab3-main-only")&&(a=n.URL+"&f_pin="+o+"&origin=33")}let r=`\n      <div id="gifs-${i}" class="gifs">\n      <a onclick="event.preventDefault(); goToURL('${a}');">\n          <img src="/nexilis/assets/img/gif/${n.FILENAME}">\n        </a>\n      </div>\n    `,s=n.DIRECTION;if("left"===n.DIRECTION)$("#gif-container").addClass("bottom"),$("#gif-container").addClass("right");else if("right"===n.DIRECTION)$("#gif-container").addClass("bottom"),$("#gif-container").addClass("left");else if("up"===n.DIRECTION){$("#gif-container").addClass("bottom");let e=["right","left"],t=Math.floor(Math.random()*e.length);$("#gif-container").addClass(e[t])}else if("down"===n.DIRECTION){$("#gif-container").addClass("top");let e=["right","left"],t=Math.floor(Math.random()*e.length);$("#gif-container").addClass(e[t])}else if(null===n.DIRECTION){let e=["right","left"],t=Math.floor(Math.random()*e.length);$("#gif-container").addClass("bottom"),$("#gif-container").addClass(e[t]),s="left"==e[t]?"right":"left"}$("#gif-container").append(r),document.getElementById("gifs-2"),animateAd(i,n.FILENAME,n.ANIM_TYPE,s)}function goToURL(e,t=!1){if(window.Android){if(window.Android.checkProfile()){window.Android.getFPin();window.location=e}}else{if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.checkProfile&&!1===t)return void window.webkit.messageHandlers.checkProfile.postMessage({param1:e,param2:"gif"});new URLSearchParams(window.location.search).get("f_pin");window.location=e}}function animateAd(e,t,i,o){var n=$("#gifs-"+e).width();if("horizontal"===i){var a=$(window).width(),r=(n=$("#gifs-"+e).width(),a-(115+(s=20)));"right"===o?$("#gif-container").animate({left:r+"px"},5e3,(function(){$("#gif-container").css({right:s+"px",left:"auto"}),$("#gif-container").fadeOut()})):"left"===o&&$("#gif-container").animate({right:r+"px"},5e3,(function(){$("#gif-container").css({right:"auto",left:"20px"}),$("#gif-container").fadeOut()}))}else if("vertical"===i){a=$(window).height(),n=170;var s=140;if("up"===o){r=a-(n+30);$("#gif-container").animate({bottom:r+"px"},5e3,(function(){$("#gif-container").css({top:"30px",bottom:"auto"}),$("#gif-container").fadeOut()}))}else{r=a-(n+140);$("#gif-container").animate({top:r+"px"},5e3,(function(){$("#gif-container").css({top:"auto",bottom:"140px"}),$("#gif-container").fadeOut()}))}}$(window).scroll((function(){$(window).scrollTop()>=150&&($("#gif-container").stop(!0,!1),$("#gif-container").fadeOut())}))}let categoryTree,category_arr=[];function fetchDefaultCategory(){let e="";e=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin");let t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let e=JSON.parse(t.responseText);if("1"===e.APP_URL||"2"===e.APP_URL?null!==e.APP_URL_DEFAULT&&""!==e.APP_URL_DEFAULT&&(defaultCategory=e.APP_URL_DEFAULT):"1"!==e.CONTENT_TAB_LAYOUT&&"2"!==e.CONTENT_TAB_LAYOUT||null!==e.CONTENT_TAB_DEFAULT&&""!==e.CONTENT_TAB_DEFAULT&&(defaultCategory=e.CONTENT_TAB_DEFAULT),""!==defaultCategory&&null!==defaultCategory){defaultCategory=defaultCategory.replaceAll(",","-"),visibleCategory=defaultCategory;let e=defaultCategory.split("-"),t=visibleCategory.split("-");if(""!=activeFilter){let t=activeFilter.split("-");e.forEach((e=>{t.includes(e)&&$("#root-category input#"+e).prop("checked",!0)}))}else e.forEach((e=>{$("#root-category input#"+e).prop("checked",!0)}));try{if("347"===BE_ID){$("#root-category li").each((function(){let e=$(this).attr("id").split("-")[1];t.includes(e)||$(this).addClass("d-none")})),activeFilter=defaultCategory;const e=new URL(window.location);e.searchParams.set("filter",defaultCategory.replaceAll(",","-")),window.history.pushState({},"",e)}}catch(e){}}fetchLinks(),setInterval((function(){fetchLinks()}),6e5)}},t.open("get","/nexilis/logics/fetch_default_category?f_pin="+e),t.send()}function fetchCategory(){let e="";e=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin");let t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status&&(category_arr=JSON.parse(t.responseText),category_arr.length>0)){categoryTree=unflatten(category_arr);let e={CATEGORY_ID:"0",NAME:"root",CHILDREN:categoryTree};createCategoryCheckbox($("#categoryFilter-body #root-category"),e)}},t.open("get","/nexilis/logics/fetch_posts_category?f_pin="+e),t.send()}const unflatten=e=>{const t=e.map((e=>({...e}))).reduce(((e,t)=>{e[t.CATEGORY_ID]=e[t.CATEGORY_ID]||t,e[t.PARENT]=e[t.PARENT]||{};const i=e[t.PARENT];return i.CHILDREN=i.CHILDREN||[],i.CHILDREN.push(t),e}),{});return Object.values(t).find((e=>void 0===e.CATEGORY_ID)).CHILDREN};function createCategoryCheckbox(e,t){for(var i in t.CHILDREN)if(null!=t.CHILDREN){var o=t.CHILDREN[i];if($item=$("<li>",{id:"item-"+o.CATEGORY_ID}),$item.append($("<input>",{type:"checkbox",id:o.CATEGORY_ID,name:"item-"+o.CATEGORY_ID})),$item.append($("<label>",{for:o.CATEGORY_ID,text:o.NAME})),e.append($item),o.CHILDREN)createCategoryCheckbox($("<ul>").appendTo($item),o)}if(""!==defaultCategory&&null!==defaultCategory){defaultCategory.split("-");let e=visibleCategory.split("-");try{if("347"===BE_ID){$("#root-category li").each((function(){let t=$(this).attr("id").split("-")[1];e.includes(t)||$(this).addClass("d-none")})),activeFilter=defaultCategory;const t=new URL(window.location);t.searchParams.set("filter",defaultCategory.replaceAll(",","-")),window.history.pushState({},"",t)}}catch(e){}}checkboxBehavior(),activeCategoryTab()}function checkboxBehavior(){$("#categoryFilter-body li :checkbox").on("click",(function(){var e=$(this).is(":checked");$(this).closest("ul").find("ul li input:checkbox").prop("checked",e)}))}function checkArray(){var e=[];$("#categoryFilter-body input:checked").each((function(){e.push($(this).attr("id"))}))}$(window).on("load",(async function(){let e=new URLSearchParams(window.location.search);null!=e.get("official")&&(otherFilter.official=e.get("official")),null!=e.get("verified")&&(otherFilter.verified=e.get("verified")),null!=e.get("friends")&&(otherFilter.friends=e.get("friends")),null!=e.get("others")&&(otherFilter.others=e.get("others")),fetchCategory(),activeCategoryTab(),fetchDefaultCategory(),hasStoreId(),onClickHasStory(),changeLayout(),null!=document.getElementById("gif-container")&&getGIFs(),$(window).scroll((function(){Math.ceil($(window).scrollTop()+1.5*$(window).height())>=$("#content-grid").height()&&!busy&&(busy=!0,offset=limit+offset,fillGridWidgets("#content-grid",currentSort,limit,offset))}))}));let video_arr=["webm","mp4"],img_arr=["png","jpg","webp","gif","jpeg"];class ShowProduct{constructor(e){let t=e.thumb_id.split("|"),i=(richText(decodeURIComponent((e.name+"").replace(/\+/g,"%20"))),richText(decodeURIComponent((e.description+"").replace(/\+/g,"%20"))),""),o="";if(o='<img class="close-icon" onclick="closeModal()" src="../assets/img/close-icon.png" style="\n                    position: absolute;\n                    z-index: 500;\n                    right: 0;\n                    margin-right: 20px;\n                    margin-top: 20px;\n                    width: 17px;\n                    height: 17px;\n                    opacity: 0.8;\n                    filter: drop-shadow(1px 0px 1px #222);\n                ">',1==t.length){let o=ext(t[0]);video_arr.includes(o)?i+=`\n                <div class="video-wrap" id="videowrap-modal-${e.CODE}">\n                <video class="myvid" autoplay muted playsinline src="${t[0].includes("http")?t[0]:"/nexilis/images/"+t[0]}">\n                </video>\n                <div class="video-sound" onclick="event.stopPropagation(); toggleVideoMute('videowrap-modal-${e.CODE}');">\n                <img src="../assets/img/video_mute.png" />\n                </div>\n                <div class="video-play d-none" onclick="event.stopPropagation(); playVid('videowrap-modal-${e.CODE}');">\n                '<img src="../assets/img/video_play.png" />\n                </div>\n                </div>\n                `:img_arr.includes(o)&&(i+=`\n                    <img draggable="false" src="${"http"==t[0].substr(0,4)?th:"/nexilis/images/"+t[0]}" class="d-block w-100">\n                `)}else{i='\n            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel" data-bs-interval="false">\n            <div class="carousel-inner">\n            ';let o=t.filter((e=>""!=e.trim()||e.length>0));o.forEach(((t,o)=>{if(""!=t.trim()){i+=`<div class="carousel-item${0==o?" active":""}">`;let n=ext(t);video_arr.includes(n)?i+=`\n                        <div class="video-wrap" id="videowrap-modal-${e.CODE}">\n                        <video class="myvid" autoplay muted playsinline src="${t.includes("http")?t:"/nexilis/images/"+t}">\n                        </video>\n                        <div class="video-sound" onclick="event.stopPropagation(); toggleVideoMute('videowrap-modal-${e.CODE}');">\n                        <img src="../assets/img/video_mute.png" />\n                        </div>\n                        <div class="video-play d-none" onclick="event.stopPropagation(); playVid('videowrap-modal-${e.CODE}');">\n                        '<img src="../assets/img/video_play.png" />\n                        </div>\n                        </div>\n                        `:img_arr.includes(n)&&(i+=`\n                        <img draggable="false" src="${"http"==t.substr(0,4)?t:"/nexilis/images/"+t}" class="d-block w-100">\n                    `),i+="</div>"}})),o.length>1&&(i+='\n            </div>\n            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">\n                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                    <span class="visually-hidden">Previous</span>\n                </button>\n                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">\n                    <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                    <span class="visually-hidden">Next</span>\n                </button>\n            </div>\n            ')}let n="",a="";null!=e.LINK&&null!=e.LINK&&""!=e.LINK.trim()&&(n=e.LINK,"http"!=n.substring(0,4)&&(n="https://"+n),a=`\n           <a href="${n}" style="text-decoration:underline; color:#0d6efd";>Link</a>\n            `,"16467163130000246a901c4"==e.CODE&&(a=`\n           <a href="${n+"?f_pin="+r}" style="text-decoration:underline; color:#0d6efd";>Register membership</a>\n            `));let r="";r=window.Android?window.Android.getFPin():new URLSearchParams(window.location.search).get("f_pin"),this.html_body='<img class="close-icon" onclick="closeModal()" src="../assets/img/close-icon.png" style="\n                    position: absolute;\n                    z-index: 500;\n                    right: 0;\n                    margin-right: 20px;\n                    margin-top: 20px;\n                    width: 17px;\n                    height: 17px;\n                    opacity: 0.8;\n                    filter: drop-shadow(1px 0px 1px #222);\n                ">'+i;let s=dataFiltered.find((t=>t.LINK_ID==e.CODE)).PROFPIC;s=null==s||""==s?"/nexilis/assets/img/ic_person_boy.png":"/filepalio/image/"+s;let l=dataFiltered.find((t=>t.LINK_ID==e.CODE)).USERNAME,c=dataFiltered.find((t=>t.LINK_ID==e.CODE)).F_PIN,d=dataFiltered.find((t=>t.LINK_ID==e.CODE)).OFFICIAL_ACCOUNT,u="";1==d||3==d?u='<img src="/nexilis/assets/img/ic_official_flag.webp" style="width:15px; height:15px;"/>':2==d&&(u='<img src="/nexilis/assets/img/ic_verified_flag.png" style="width:15px; height:15px;"/>'),this.html_header=`\n    <div class="container-fluid">\n      <div class="row">\n        <div class="col-10 d-flex align-items-center">\n          <a onclick="openProfile('tab3-profile?f_pin=${r}&store_id=${c}')">\n            <img src="${s}" class="align-self-start rounded-circle me-2" style="width:35px; height:35px; object-fit:cover;">\n            <div class="media-body" style="display:inline-block; flex-grow:1;">\n              <h6>${u} ${l}</h6>\n            </div>\n          </a>\n        </div>\n          \n        <div class="col-2 d-flex align-items-center">\n          <div class="dropdown dropdown-edit edit-menu-${c}" data-isadmin="${user_type}"><a class="post-status dropdown-toggle" data-bs-toggle="dropdown" id="edt-del-${c}"><img src="../assets/img/icons/More.png" height="25" width="25" style="background-color:unset; float:right"></a>\n              <ul class="dropdown-menu"">\n                  <li><a class="dropdown-item button_report ${c!=r?"":"d-none"}" onclick="reportContent('${e.CODE}')">Report/flag Content</a></li>\n                  <li><a class="dropdown-item button_report ${c!=r?"":"d-none"}" onclick="reportUser('${c}')">Report/flag User</a></li>\n                  <li><a class="dropdown-item button_block ${c!=r?"":"d-none"}" onclick="blockContent('${e.CODE}')" style="color:darkred">Remove/Block Content</a></li>\n                  <li><a class="dropdown-item button_block ${c!=r?"":"d-none"}" onclick="blockUser('${c}')" style="color:darkred">Remove/Block User</a></li>\n              </ul>\n          </div>\n        </div>\n      </div>\n    </div>`,this.parent=document.body,this.modal_header=document.querySelector("#modal-product .modal-header"),this.modal_body=document.querySelector("#modal-product .modal-body"),this.modal_header.innerHTML=" ",this.modal_body.innerHTML=" ",this._createModal(),window.Android?window.Android.setIsProductModalOpen(!0):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.setIsProductModalOpen&&window.webkit.messageHandlers.setIsProductModalOpen.postMessage({param1:!0})}static async build(e,t){let i=await getProductThumbs(e,t);return new ShowProduct(i)}question(){}_createModal(){this.modal_body.innerHTML=this.html_body,this.modal_header.innerHTML=this.html_header,$("#modal-product").modal("show"),$("#carouselExampleIndicators").carousel()}_destroyModal(){$("#modal-product").modal("hide")}}async function showProductModal(e,t){await ShowProduct.build(e,t)}function getProductThumbs(e,t){let i=new FormData;return i.append("product_id",e),i.append("is_product",t),new Promise((function(e,t){var o=new XMLHttpRequest;o.open("POST","/nexilis/logics/get_product_thumbs"),o.onload=function(){this.status>=200&&this.status<300?e({thumb_id:JSON.parse(o.response).THUMB_ID,name:JSON.parse(o.response).NAME,description:JSON.parse(o.response).DESCRIPTION,CODE:JSON.parse(o.response).CODE,LINK:JSON.parse(o.response).LINK}):t({status:this.status,statusText:o.statusText})},o.onerror=function(){t({status:this.status,statusText:o.statusText})},o.send(i)}))}function openProfile(e){let t=e;if("347"==BE_ID){let e=new URLSearchParams(window.location.search).get("query"),i=new URLSearchParams(window.location.search).get("filter");e&&""!=e&&(t+="&query="+e),i&&""!=i&&(t+="&filter="+i)}window.location.href=t}function closeModal(e=!1){$("#modal-product").modal("hide"),window.Android&&window.Android.setIsProductModalOpen(!1),window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.setIsProductModalOpen&&0==e&&window.webkit.messageHandlers.setIsProductModalOpen.postMessage({param1:!1})}$(".dropdown-edit").on("show.bs.dropdown",(function(){$(".close-icon").hide()})),$(".dropdown-edit").on("hide.bs.dropdown",(function(){$(".close-icon").show()}));